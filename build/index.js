"use strict";const k=Math.PI,ca=t=>t<0?-t:t,da=(t,i)=>t<i?t:i,ea=(t,i)=>i<t?t:i,fa=(t,i=0,s=1)=>t<i?i:s<t?s:t,ia=(t,i=0,s=1)=>s-i?fa((t-i)/(s-i)):0,ka=(t,i=0,s=1)=>i+fa(t)*(s-i),la=(t,i,s,a)=>2*ca(t.x-s.x)<i.x+a.x&2*ca(t.y-s.y)<i.y+a.y,t=(t=1,i=0)=>i+(t-i)*Math.random(),ma=(i=1,s=0)=>0|t(i,s),oa=(i=1)=>0<i?na(i*t(0/i,1)**.5):new u,na=(i=1)=>ra(new u,t(2*k),i),sa=(i=new w,s=new w(0,0,0,1),a)=>a?i.ea(s,t()):new w(t(i.r,s.r),t(i.o,s.o),t(i.b,s.b),t(i.a,s.a));let ta=1;const y=(t=0,i)=>null==t.x?new u(t,null==i?t:i):new u(t.x,t.y);function ra(t,i=0,s=1){return t.x=s*Math.sin(i),t.y=s*Math.cos(i),t}function wa(t,i){return(t.x-i.x)**2+(t.y-i.y)**2}function xa(t,i=1){var s=t.length();return i<s?t.scale(i/s):t}function ya(t,i){return 0<=t.x&&0<=t.y&&t.x<i.x&&t.y<i.y}class u{constructor(t=0,i=0){this.x=t,this.y=i}B(){return new u(this.x,this.y)}add(t){return new u(this.x+t.x,this.y+t.y)}v(t){return new u(this.x-t.x,this.y-t.y)}multiply(t){return new u(this.x*t.x,this.y*t.y)}rb(t){return new u(this.x/t.x,this.y/t.y)}scale(t){return new u(this.x*t,this.y*t)}length(){return(this.x**2+this.y**2)**.5}normalize(t=1){var i=this.length();return i?this.scale(t/i):new u(0,t)}angle(){return Math.atan2(this.x,this.y)}rotate(t){var i=Math.cos(t);return t=Math.sin(t),new u(this.x*i-this.y*t,this.x*t+this.y*i)}direction(){return ca(this.x)>ca(this.y)?this.x<0?3:1:this.y<0?2:0}floor(){return new u(Math.floor(this.x),Math.floor(this.y))}ea(t,i){return this.add(t.v(this).scale(fa(i)))}toString(t=3){return`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`}}function za(t=0){var i=new w,s=(t,i,s)=>(s=(s%1+1)%1)<1/6?t+6*(i-t)*s:s<.5?i:s<2/3?t+(i-t)*(2/3-s)*6:t;return i.r=s(1.4-1,1,t+1/3),i.o=s(1.4-1,1,t),i.b=s(1.4-1,1,t-1/3),i.a=1,i}function Da(t){return(255*t.r|0)+(255*t.o<<8)+(255*t.b<<16)+(255*t.a<<24)}class w{constructor(t=1,i=1,s=1,a=1){this.r=t,this.o=i,this.b=s,this.a=a}B(){return new w(this.r,this.o,this.b,this.a)}add(t){return new w(this.r+t.r,this.o+t.o,this.b+t.b,this.a+t.a)}v(t){return new w(this.r-t.r,this.o-t.o,this.b-t.b,this.a-t.a)}multiply(t){return new w(this.r*t.r,this.o*t.o,this.b*t.b,this.a*t.a)}rb(t){return new w(this.r/t.r,this.o/t.o,this.b/t.b,this.a/t.a)}scale(t,i=t){return new w(this.r*t,this.o*t,this.b*t,this.a*i)}ea(t,i){return this.add(t.v(this).scale(fa(i)))}toString(){return`rgb(${255*this.r|0},${255*this.o|0},${255*this.b|0},${this.a})`}}function Ea(t){return null!=t.time?ia(t.time-Fa,t.setTime,0):0}class B{constructor(t){this.time=null==t?void 0:Fa+t,this.setTime=t}set(t=0){this.time=Fa+t,this.setTime=t}active(){return Fa<=this.time}get(){return null!=this.time?Fa-this.time:0}toString(){}}let Ga=y(1920,1200),Pa=y(),Qa=y(16),Ra=y(1),Sa=0,F=y(),H=ea(Qa.x,Qa.y);const Xa=1/60;let Ya=[],Za=[],$a=0,Fa=0,ab=0,db=0,gb=0,hb,ib;function jb(t,a,h,e,n,i){kb.onerror=kb.onload=()=>{ib=y(.3).rb(hb=y(kb.width,kb.height)),document.body.style="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none;-moz-user-select:none",document.body.appendChild(K=document.createElement("canvas")),lb=K.getContext("2d"),K.style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)",mb(),document.body.appendChild(M=document.createElement("canvas")),N=M.getContext("2d"),M.style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)",t(),r()};const r=(t=0)=>{var i=t-db;for(db=t,ab+=i/1e3,gb=da(gb+i,50),Pa.x?(M.width=K.width=Pa.x,M.height=K.height=Pa.y,t=innerWidth/innerHeight,i=K.width/K.height,K.style.width=M.style.width=t<i?"100%":"",K.style.height=M.style.height=t<i?"":"100%",nb&&(nb.style.width=K.style.width,nb.style.height=K.style.height)):(M.width=K.width=da(innerWidth,Ga.x),M.height=K.height=da(innerHeight,Ga.y)),ob=y(K.width,K.height),t=0,gb<0&&-9<gb&&(t=gb,gb=0);0<=gb;gb-=1e3/60)document.hasFocus()||(P=[[]]),pb=qb(tb),ub(),a(),vb(),h(),wb();gb+=t,xb(),e(),Ya.sort((t,i)=>t.T-i.T);for(const s of Ya)s.$||s.fa();n(),yb(),zb(),requestAnimationFrame(r)};i?kb.src=i:kb.onload()}function xb(){ob=y(K.width,K.height),lb.imageSmoothingEnabled=!1;var t=K.width,i=K.height,s=F.x,a=F.y,h=H;R.viewport(0,0,nb.width=t,nb.height=i),R.clear(16384),R.bindTexture(3553,Ab),R.useProgram(Bb),Cb=void 0,t=2*h/t,i=2*h/i,R.uniformMatrix4fv(R.getUniformLocation(Bb,"m"),0,new Float32Array([t,0,0,0,0,i,0,0,1,1,-1,1,-1-t*s,-1-i*a,0,0]))}function vb(){Za=Ya.filter(t=>t.mb);const s=t=>{if(!t.$){t.update();for(const i of t.children)s(i)}};for(const t of Ya)t.parent||s(t);Ya=Ya.filter(t=>!t.$),Fa=++$a/60}function Db(t){if(!t.$){t.$=1,t.parent&&t.parent.removeChild(t);for(const i of t.children)Db(i,i.parent=0)}}function Gb(t,i,s=y(),a=0){i.parent||t.children.includes(i),t.children.push(i),i.parent=t,i.la=s.B(),i.Gb=a}function Hb(t,i=0){t.mb=i,t.Fb=0,t.ga=1}class Lb{constructor(t=y(),i=Ra,s=-1,a=Qa,h=0,e,n=0){this.g=t.B(),this.size=i,this.O,this.j=s,this.A=a,this.angle=h,this.color=e,this.Ga,this.i=1,this.ra=this.K=.99,this.F=0,this.Ta=.8,this.ca=1,this.T=n,this.h=new u,this.Ha=0,this.Sb=Fa,this.children=[],this.ga=1,Ya.push(this)}update(){var t=this.parent;if(t)this.g=this.la.multiply(y(t.L?-1:1,1)).rotate(-t.angle).add(t.g),this.angle=(t.L?-1:1)*this.Gb+t.angle;else if(this.h.x=fa(this.h.x,-1,1),this.h.y=fa(this.h.y,-1,1),t=this.g.B(),this.g.x+=this.h.x*=this.K,this.g.y+=this.h.y=this.K*this.h.y+Sa*this.ca,this.angle+=this.Ha*=this.ra,this.i){var i,s,a,h,e,n,r,c=this.h.y<0;if(this.da&&(i=this.da.h?this.da.h.x:0,this.h.x=i+(this.h.x-i)*this.Ta,this.da=0),this.mb)for(var o of Za)!this.Fb&!o.Fb||o.$||o.parent||o==this||la(this.g,this.size,o.g,o.size)&&(la(t,this.size,o.g,o.size)?(i=(s=(i=t.v(o.g)).length())<.01?na(.001):i.scale(.001/s),this.h=this.h.add(i),o.i&&(o.h=o.h.v(i))):(i=this.size.add(o.size),s=2*(t.y-o.g.y)>i.y+Sa,a=2*ca(t.y-o.g.y)<i.y,h=2*ca(t.x-o.g.x)<i.x,!s&&!h&&a||(this.g.y=o.g.y+(i.y/2+.001)*(t.y-o.g.y<0?-1:1),o.da&&c||!o.i?(c&&(this.da=o),this.h.y*=-this.F):o.i&&(e=(this.i*this.h.y+o.i*o.h.y)/(this.i+o.i),n=o.h.y*(o.i-this.i)/(this.i+o.i)+2*this.h.y*this.i/(this.i+o.i),r=ea(this.F,o.F),this.h.y=ka(r,e,this.h.y*(this.i-o.i)/(this.i+o.i)+2*o.h.y*o.i/(this.i+o.i)),o.h.y=ka(r,e,n))),s||!a&&h||(this.g.x=o.g.x+(i.x/2+.001)*(t.x-o.g.x<0?-1:1),o.i?(i=(this.i*this.h.x+o.i*o.h.x)/(this.i+o.i),s=o.h.x*(o.i-this.i)/(this.i+o.i)+2*this.h.x*this.i/(this.i+o.i),a=ea(this.F,o.F),this.h.x=ka(a,i,this.h.x*(this.i-o.i)/(this.i+o.i)+2*o.h.x*o.i/(this.i+o.i)),o.h.x=ka(a,i,s)):this.h.x*=-this.F)));this.ga&&Mb(this.g,this.size,this)&&!Mb(t,this.size,this)&&(o=Mb(new u(this.g.x,t.y),this.size,this),!Mb(new u(t.x,this.g.y),this.size,this)&&o||(this.da=c,this.h.y*=-this.F,(c=(t.y-this.size.y/2|0)-(t.y-this.size.y/2))<0&&c>this.K*this.h.y+Sa*this.ca&&(this.h.y=this.K?(c-Sa*this.ca)/this.K:0),this.g.y=t.y),o&&(this.g.x=t.x,this.h.x*=-this.F))}}fa(){Nb(this.g,this.O||this.size,this.j,this.A,this.color,this.angle,this.L,this.Ga)}removeChild(t){t.parent==this&&this.children.includes(t),this.children.splice(this.children.indexOf(t),1),t.parent=0}toString(){}}const kb=new Image;let K,lb,M,N,ob=y();const qb=t=>t.add(y(.5)).v(ob.scale(.5)).multiply(y(1/H,-1/H)).add(F),Ob=t=>t.v(F).multiply(y(H,-H)).add(ob.scale(.5)).v(y(.5));function Nb(t,i=y(1),s=-1,a=Qa,h=new w,e=0,n,r=new w(0,0,0,0)){var c,o,b;s<0||!kb.width?Pb(t.x,t.y,i.x,i.y,e,0,0,0,0,0,Da(h)):(b=s%(c=hb.x/a.x|0)*(o=a.x/hb.x),s=(s/c|0)*(a=a.y/hb.y),Pb(t.x,t.y,n?-i.x:i.x,i.y,e,b+ib.x,s+ib.y,b-ib.x+o,s-ib.y+a,Da(h),Da(r)))}function Qb(t,i=y(1),s){var a=Qa;Nb(qb(t),i.scale(1/H),-1,a,s,void 0,0,0)}function Rb(t,i){var s=y(.055),a=lb;t=Ob(t),s=s.scale(H),a.save(),a.translate(t.x+.5|0,t.y-.5|0),a.rotate(0),a.scale(s.x,s.y),i(a),a.restore()}function Sb(t,i,s=1,a=new w,h=0,e=new w(0,0,0),n="center"){N.fillStyle=a,N.lineWidth=h,N.strokeStyle=e,N.textAlign=n,N.font=s+"px arial",N.textBaseline="middle",N.lineJoin="round",i=i.B(),(t+"").split("\n").forEach(t=>{h&&N.strokeText(t,i.x,i.y),N.fillText(t,i.x,i.y),i.y+=s})}let Tb;function Ub(r,t,c,o=4){const b=r.context,l=(b.save(),b.imageSmoothingEnabled=!1,r.A),u=l.add(r.dd).scale(o),d=r.image.width/r.A.x|0;t.split("\n").forEach((i,s)=>{var a=i.length*l.x*o/2|0;for(let t=i.length;t--;){((h=i[t].charCodeAt())<32||127<h)&&(h=127);var h=(e=r.nd+h-32)%d,e=e/d|0,n=c.add(y(t,s).multiply(u));b.drawImage(r.image,h*l.x,e*l.y,l.x,l.y,n.x-a,n.y,l.x*o,l.y*o)}}),b.restore()}function Vb(t,i,s,a=1){Ub(t,i,Ob(s).floor(),a*H|0)}class Wb{constructor(){var t=y(8),i=y(0,1),s=N;Tb||((Tb=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAYAQAAAAA9+x6JAAAAAnRSTlMAAHaTzTgAAAGiSURBVHjaZZABhxxBEIUf6ECLBdFY+Q0PMNgf0yCgsSAGZcT9sgIPtBWwIA5wgAPEoHUyJeeSlW+gjK+fegWwtROWpVQEyWh2npdpBmTUFVhb29RINgLIukoXr5LIAvYQ5ve+1FqWEMqNKTX3FAJHyQDRZvmKWubAACcv5z5Gtg2oyCWE+Yk/8JZQX1jTTCpKAFGIgza+dJCNBF2UskRlsgwitHbSV0QLgt9sTPtsRlvJjEr8C/FARWA2bJ/TtJ7lko34dNDn6usJUMzuErP89UUBJbWeozrwLLncXczd508deAjLWipLO4Q5XGPcJvPu92cNDaN0P5G1FL0nSOzddZOrJ6rNhbXGmeDvO3TF7DeJWl4bvaYQTNHCTeuqKZmbjHaSOFes+IX/+IhHrnAkXOAsfn24EM68XieIECoccD4KZLk/odiwzeo2rovYdhvb2HYFgyznJyDpYJdYOmfXgVdJTaUi4xA2uWYNYec9BLeqdl9EsoTw582mSFDX2DxVLbNt9U3YYoeatBad1c2Tj8t2akrjaIGJNywKB/7h75/gN3vCMSaadIUTAAAAAElFTkSuQmCC"),this.image=Tb,this.A=t,this.dd=i,this.nd=0,this.context=s}}const Xb=(t,i=0)=>P[i]&&1&P[i][t]?1:0;let pb=y(),tb=y(),Yb=0,Zb=0;const $b=(t,i=0)=>Xb(t,i+1);let P=[[]];function wb(){for(const t of P)for(const i in t)t[i]&=1;Yb=0}onkeydown=t=>{t.repeat||(P[Zb=0][ac(t.keyCode)]=3)},onkeyup=t=>{P[0][ac(t.keyCode)]=4};const ac=t=>87==t?38:83==t?40:65==t?37:68==t?39:t,bc=(onmousedown=t=>{P[Zb=0][t.button]=3,onmousemove(t),t.button&&t.preventDefault()},onmouseup=t=>P[0][t.button]=2&P[0][t.button]|4,onmousemove=t=>{var i;return t=K?(i=K.getBoundingClientRect(),y(K.width,K.height).multiply(y(ia(t.x,i.left,i.right),ia(t.y,i.top,i.bottom)))):y(),tb=t},onwheel=t=>t.ctrlKey||(Yb=t.deltaY<0?-1:1),oncontextmenu=()=>!1,[]);function ub(){if(navigator.getGamepads&&document.hasFocus()){var i=navigator.getGamepads();for(let t=i.length;t--;){var s=i[t];const e=P[t+1]||(P[t+1]=[]),n=bc[t]||(bc[t]=[]);if(s){for(var a=t=>.3<t?ia(t,.3,.8):t<-.3?-ia(-t,.3,.8):0,h=0;h<s.axes.length-1;h+=2)n[h>>1]=xa(y(a(s.axes[h]),a(-s.axes[h+1])));for(a=s.buttons.length;a--;)h=s.buttons[a],e[a]=h.pressed?1+2*!$b(a,t):4*$b(a,t),Zb|=!t&&h.pressed;(s=y($b(15,t)-$b(14,t),$b(12,t)-$b(13,t))).x**2+s.y**2&&(n[0]=xa(s))}}}}if(void 0!==window.ontouchstart){let s,a;ontouchstart=ontouchmove=ontouchend=t=>{t.button=0;var i=t.touches.length;return i?(a||cc([dc(...[0,a=1])]),t.x=t.touches[0].clientX,t.y=t.touches[0].clientY,(s?onmousemove:onmousedown)(t)):s&&onmouseup(t),s=i,!t.cancelable}}class ec{constructor(t,i=30,s=.7){this.hd=i,this.od=s,this.$a=t[1]||0,t[1]=0,this.fc=dc(...t)}play(i,s=1,a=1,h=1){var e=0;if(i){if(e=this.hd){var n=wa(F,i);if(e*e<n)return;s*=ia(n**.5,e,e*this.od)}e=2*Ob(i).x/K.width-1}return cc([this.fc],s,a+a*this.$a*h*t(-1,1),e)}}let ic;function cc(t,i=1,s=1,a=0){var h,e;if((ic=ic||new(window.AudioContext||webkitAudioContext)).resume(),"running"==ic.state)return h=ic.createBuffer(t.length,t[0].length,44100),e=ic.createBufferSource(),t.forEach((t,i)=>h.getChannelData(i).set(t)),e.buffer=h,e.playbackRate.value=s,e.loop=0,(t=ic.createGain()).gain.value=.5*i,t.connect(ic.destination),(window.StereoPannerNode?e.connect(new StereoPannerNode(ic,{pan:fa(a,-1,1)})):e).connect(t),e.start(),e}function dc(i=1,s=.05,a=220,h=0,e=0,n=.1,r=0,c=1,o=0,b=0,l=0,u=0,d=0,y=0,g=0,f=0,w=0,x=1,m=0,v=0){let p=2*k,M=o*=500*p/44100/44100,A=[],z=(s=a*=(1+s*t(-1,1))*p/44100,0),T=0,B=0,F=1,R=0,P=0,S=0,C,K;for(b*=500*p/44100**3,g*=p/44100,l*=p/44100,u*=44100,d=44100*d|0,K=(h=44100*h+9)+(m*=44100)+(e*=44100)+(n*=44100)+(w*=44100)|0;B<K;A[B++]=S)++P%(100*f|0)||(S=r?1<r?2<r?3<r?Math.sin((z%p)**3):ea(da(Math.tan(z),1),-1):1-(2*z/p%2+2)%2:1-4*ca(Math.round(z/p)-z/p):Math.sin(z),S=(d?1-v+v*Math.sin(p*B/d):1)*(S<0?-1:1)*(S<0?-S:S)**c*i*.5*(B<h?B/h:B<h+m?1-(B-h)/m*(1-x):B<h+m+e?x:B<K-w?(K-B-w)/n*x:0),S=w?S/2+(w>B?0:(B<K-w?1:(K-B)/w)*A[B-w|0]/2):S),C=(a+=o+=b)*Math.cos(g*T++),z+=C-C*y*(1-1e9*(Math.sin(B)+1)%2),F&&++F>u&&(a+=l,s+=l,F=0),!d||++R%d||(a=s,o=M,F=F||1);return A}let jc=[],kc=y();function lc(t){for(kc=t,t=(jc=[]).length=ca(kc.x*kc.y);t--;)jc[t]=0}const mc=(t,i=0)=>{ya(t,kc)&&(jc[(0|t.y)*kc.x+t.x|0]=i)};function Mb(t,i=y(),s){var a=ea(t.x-i.x/2|0,0),h=ea(t.y-i.y/2|0,0),e=da(t.x+i.x/2,kc.x);for(t=da(t.y+i.y/2,kc.y);h<t;++h)for(i=a;i<e;++i){var n=jc[h*kc.x+i];if(n&&(!s||0<n))return 1}}class nc{constructor(t,i=0,s=0,a=new w){this.eb=t,this.direction=i,this.L=s,this.color=a}clear(){this.eb=this.direction=this.L=0,color=new w}}function oc(t,i){var s=i.floor().add(t.g).add(y(.5));pc(t,s,t=>t.clearRect(-.5,-.5,1,1)),null!=(i=t.getData(i)).eb&&Nb(s,y(1),i.eb,t.A,i.color,i.direction*k/2,i.L)}function qc(t,i=0){i&&(t.canvas.width=t.size.x*t.A.x,t.canvas.height=t.size.y*t.A.y),t.Pb=[K,lb,F,H],K=t.canvas,lb=t.context,F=t.size.scale(.5),H=t.A.x,xb()}function pc(t,i,s){var a=y(1);const h=t.context;h.save(),i=i.v(t.g).multiply(t.A),a=a.multiply(t.A),h.translate(i.x,t.canvas.height-i.y),h.rotate(0),h.scale(a.x,a.y),s(h),h.restore()}class rc extends Lb{constructor(t=kc){var i=y(1);for(super(y(),t,-1,Qa,0,void 0,0),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.scale=i,this.Lc,this.data=[],t=this.size,t=ca(t.x*t.y);t--;)this.data.push(new nc)}setData(t,i,s){ya(t,this.size)&&(this.data[(0|t.y)*this.size.x+t.x|0]=i,s&&oc(this,t))}getData(t){return ya(t,this.size)&&this.data[(0|t.y)*this.size.x+t.x|0]}update(){}fa(){var t=Ob(this.g.add(y(0,this.size.y*this.scale.y)));(this.Lc?N:lb).drawImage(this.canvas,t.x,t.y,H*this.size.x*this.scale.x,H*this.size.y*this.scale.y)}}function sc(i){var s=null!=i.Oa.x?new u(t(-.5,.5),t(-.5,.5)).multiply(i.Oa).rotate(i.angle):oa(.5*i.Oa),s=new tc(i.g.add(s),i.j,i.A,i.angle+t(i.Mb,-i.Mb));const a=i.$a;var h=(c=i=>i+i*t(a,-a))(i.fd),e=c(i.cb),n=c(i.kd),r=c(i.speed),c=c(i.Zb)*(2*(0|t(2))-1);const o=t(i.sb,-i.sb),b=sa(i.kc,i.lc,i.Ob),l=sa(i.ic,i.jc,i.Ob);s.ua=b,s.ta=l.v(b),s.h=ra(new u,i.angle+o,r),s.Ha=c,s.Qc=h,s.cb=e,s.ld=n-e,s.Ra=i.Ra,s.K=i.K,s.ra=i.ra,s.F=i.F,s.Ta=i.Ta,s.ca=i.ca,s.ga=i.ga,s.qa=i.qa,s.T=i.T,s.Ea=i.Ea,s.L=t()<.5,s.qb=i.ud,i.ed&&i.ed(s)}class uc extends Lb{constructor(t,i,s=0,a=0,h=100,e=k,n=-1,r=Qa,c=new w,o=new w,b=new w(1,1,1,0),l=new w(1,1,1,0),d=.5,y=.1,g=1,f=.1,x=.05,m=1,v=1,p=0,M=k,A=.1,z=.2,T,B,F=1,R=B?1e9:0){super(t,new u,n,r,i,void 0,R),this.Oa=s,this.tb=a,this.wa=h,this.sb=e,this.kc=c,this.lc=o,this.ic=b,this.jc=l,this.Ob=F,this.fd=d,this.cb=y,this.kd=g,this.speed=f,this.Zb=x,this.K=m,this.ra=v,this.ca=p,this.Mb=M,this.Ra=A,this.$a=z,this.ga=T,this.qa=B,this.ia=this.Ea=0}update(){if(this.parent&&super.update(),!this.tb||Fa-this.Sb<=this.tb){if(+this.wa){var t=1/this.wa;for(this.ia+=Xa;0<this.ia;this.ia-=t)sc(this)}}else Db(this)}fa(){}}class tc extends Lb{constructor(t,i,s,a){super(t,new u,i,s,a)}fa(){var t=da((Fa-this.Sb)/this.Qc,1),i=this.cb+t*this.ld,i=new u(i,i),s=this.Ra/2,s=new w(this.ua.r+t*this.ta.r,this.ua.o+t*this.ta.o,this.ua.b+t*this.ta.b,(this.ua.a+t*this.ta.a)*(t<s?t/s:1-s<t?(1-t)/s:1));if(this.qa&&(Cb=1),this.Ea){var a=this.h.length();const h=this.h.scale(1/a);a*=this.Ea,i.y=ea(i.x,a),this.angle=h.angle(),Nb(this.g.add(h.multiply(y(0,-a/2))),i,this.j,this.A,s,this.angle,this.L)}else Nb(this.g,i,this.j,this.A,s,this.angle,this.L);this.qa&&(Cb=void 0),1==t&&(this.color=s,this.size=i,this.qb&&this.qb(this),this.$=1)}}let vc=[],wc;function yb(){var t,i;vc.length&&(t=vc[0],i=ab-wc,wc?5<i?vc.shift(wc=0):t.fa():wc=ab)}let nb,R,Ab,Bb,T,V,xc,yc,Cb;function mb(){nb=document.createElement("canvas"),R=nb.getContext("webgl",{antialias:!1}),nb.style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)",Ab=zc(),document.body.appendChild(nb),Bb=Ac();var t=new ArrayBuffer(9437184);Bc(t.byteLength),T=new Float32Array(t),V=new Uint32Array(t);let e=xc=0;(t=(t,i,s,a,h=0)=>{t=R.getAttribLocation(Bb,t),R.enableVertexAttribArray(t),R.vertexAttribPointer(t,a,i,h,24,e),e+=a*s})("p",5126,4,2),t("t",5126,4,2),t("c",5121,1,4,1),t("a",5121,1,4,1)}function Cc(t,i){return i=R.createShader(i),R.shaderSource(i,t),R.compileShader(i),i}function Ac(){var t=R.createProgram();return R.attachShader(t,Cc("precision highp float;uniform mat4 m;attribute vec2 p,t;attribute vec4 c,a;varying vec2 v;varying vec4 d,e;void main(){gl_Position=m*vec4(p,1,1);v=t;d=c;e=a;}",35633)),R.attachShader(t,Cc("precision highp float;varying vec2 v;varying vec4 d,e;uniform sampler2D s;void main(){gl_FragColor=texture2D(s,v)*d+e;}",35632)),R.linkProgram(t),t}function Bc(t){var i=R.createBuffer();R.bindBuffer(34962,i),R.bufferData(34962,t,35048)}function zc(){var t,i=kb;if(i&&i.width)return t=R.createTexture(),R.bindTexture(3553,t),R.texImage2D(3553,0,6408,6408,5121,i),R.texParameteri(3553,10241,9728),R.texParameteri(3553,10240,9728),R.texParameteri(3553,10242,33071),R.texParameteri(3553,10243,33071),t}function Dc(){var t;xc&&(t=yc?1:771,R.blendFuncSeparate(770,t,1,t),R.enable(3042),R.bufferSubData(34962,0,T.subarray(0,36*xc)),R.drawArrays(4,0,6*xc),xc=0,yc=Cb)}function zb(t){var i=lb;(xc||t)&&(Dc(),t&&i.drawImage(nb,0,0))}function Pb(t,i,s,a,h,e,n,r,c,o=4294967295,b=0){65536!=xc&&yc==Cb||Dc();var l=Math.cos(h)/2,u=Math.sin(h)/2;h=l*s,l*=a,s*=u,a*=u,u=36*xc++,T[u++]=t-h-a,T[u++]=i-l+s,T[u++]=e,T[u++]=c,V[u++]=o,V[u++]=b,T[u++]=t+h+a,T[u++]=i+l-s,T[u++]=r,T[u++]=n,V[u++]=o,V[u++]=b,T[u++]=t-h+a,T[u++]=i+l+s,T[u++]=e,T[u++]=n,V[u++]=o,V[u++]=b,T[u++]=t-h-a,T[u++]=i-l+s,T[u++]=e,T[u++]=c,V[u++]=o,V[u++]=b,T[u++]=t+h-a,T[u++]=i-l-s,T[u++]=r,T[u++]=c,V[u++]=o,V[u++]=b,T[u++]=t+h+a,T[u++]=i+l-s,T[u++]=r,T[u++]=n,V[u++]=o,V[+u]=b}!function(){function z(t){return Math.max(Math.min(Math.round(t),24),0)}function T(t){t.Ca=z(t.x+t.U/2),t.Da=z(t.y+t.V/2),t.ub=z(t.x+t.U),t.xa=z(t.y+t.V)}function s(t){var i=t?255*t.r:v(180)+20,s=t?255*t.o:v(180)+20,a=(t=t?255*t.b:v(180)+20,v(6,24*.6)),h=v(6,24*.6),e=v(5,24*.6),n=v(0,24-e-2),r=v(6,12),c=v(8,24*.6),o=v(0,24-r-24*.2),b=v(1,3),l=v(1,3),u=v(2,r-4),d=v(1,.5*c),y=v(3,c-4),g=v(1,2),f=v(2,r-u-g),w=v(-4,-1),x=v(-4,3),m=Math.min(a/2,v(1,6));return{ac:[i-20,s-20,t-10],$b:[i-40,s-40,t-20],xc:[i,s,t],pc:0===v(2)?[0,0,0]:[200,200,200],Ic:c,Gc:r,Hc:o,ec:a,cc:h,bc:e,dc:n,tc:b,rc:l,sc:u,qc:d,cd:y,ad:g,bd:f,yc:w,td:x,Oc:2,Pc:m}}function a(a){var h;if(a)return h=s(),Object.keys(h).forEach(t=>{var s,i;0<v(20)&&(h[t]=(s=t,"number"==typeof(i=(t=a)[0][s])?(t=t.reduce((t,i)=>((i=i[s])<t[0]&&(t[0]=i),i>t[1]&&(t[1]=i),t),[1/0,-1/0]),v(t[0],t[1])):i))}),h}function R(t,i,s,a,h,e,n){var r=Math.floor((24-i)/2*n),c=24-r;return s-=r/2,[t,i,t+a,i,(h=Math.max(0,t+h+h*n))+e,s,t+a,c,t,c,h,s]}function h(t,a,i,s=4,h=0){Ob(a),t=i.ac;var e=i.$b,n=i.xc,r=i.pc,c=i.Ic,o=i.tc,b=i.rc,l=i.sc,u=i.qc,d=i.cd,y=i.ad,g=i.bd,f=i.yc,w=i.Oc,x=i.Pc,m=2<=s&&s<=6,v=[0,-.5,-1,-.5,0,.5,1,.5][s],p=[.5,.75,1,.75,.5,.25,0,.25][s],k=(s={x:(24-c)*p,y:i.Hc,U:c,V:i.Gc},(i.ec+i.cc)/2),M=(i={x:(1-p+1)/3*(24-k),y:i.dc,U:k,V:i.bc},T(s),T(i),z(i.xa+(24-i.xa)/2)),A=(Math.sin(h)+1)/2;h=R(i.x,i.xa,M,x,f*=v,w,1-A),w=R(i.ub-x,i.xa,M,x,f,w,A),x=[s.Ca-c/4,s.Da,s.Ca+c/4,s.Da,i.Ca+k/4,i.Da-1,i.Ca-k/4,i.Da-1],o={x:(p=s.x+c*p)+(k=Math.max(1,u/2)),y:(u={x:p-k-o,y:s.y+l,U:o,V:b}).y,U:o,V:b},l={x:b=Math.max(p-d/2,s.x),y:s.y+l+g,U:Math.min(b+d,s.ub)-b,V:y},d=(i,n)=>{Rb(a,t=>{var s=t,a=-.5,h=-.5,e=i,t=n;s.fillStyle=S(t),s.beginPath(),e.forEach((t,i)=>{1!=i%2&&s[0===i?"moveTo":"lineTo"](Math.round(24*a+t),Math.round(24*h+e[i+1]))}),s.closePath(),s.fill()})},y=(i,s)=>{Rb(a,t=>{t.fillStyle=S(s),t.fillRect(Math.round(-12+i.x),Math.round(-12+i.y),Math.round(i.U),Math.round(i.V))})},m?(y(i,t),d(x,t),d(h,t),d(w,t),y(s,n),u.x>=s.x&&y(u,r),o.x<=s.x+c&&y(o,r),y(l,[0,0,0])):(y(s,e),d(x,t),d(h,t),d(w,t),y(i,t))}function S(t){return t?`rgb(${Math.max(0,Math.min(255,t[0]))},${Math.max(0,Math.min(255,t[1]))},`+Math.max(0,Math.min(255,t[2])):"#fff"}function e(i,s,a){const h=E*++I;return Y(i,s,a,h,0),[6,5,4,3,3,2,2,2,1,1,1,1,1].forEach(t=>{Y(V(i,6),V(s,6),V(a,6),h+V(E-t),0+V(E-t),t,t)}),h}function n(t,i,s){const a=e(t,i,s);[14,10,6,3,3,3,2,2].forEach(t=>Y(V(7,9),V(7,9),"a",a+V(E-t),0+V(E-t),t,t))}function r(t){(t=t.createElement("canvas")).width=30*E,t.height=2*E,N=t.getContext("2d"),t.style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)",N.drawImage(kb,1e3,1e3),Y("f",0,0,0,0,12,12),Y("f","f",0,12,12,12,12),e(2,4,3),e(2,4,2),e(3,4,3),e(4,3,3),N.fillStyle="#fff",N.font="20px serif","🔪 🩸 🍖 🌿 💕 ❕ 💢 💀 🍷 🍲 ⛏️ 🪓 🔨 🕯️ 🧱     ".split(" ").forEach(t=>{N.fillText(t,E*++I-1,20)}),n(3,4,3),n(4,3,3),e(3,4,2),e(3,3,3);{const i=E*++I;Y(5,5,6,i,0),[8,8,8,8,8,6,6,6,6,4].forEach(t=>Y(V(8,9),8,"a",i+V(E-t),0+V(E-t/2),t,t/2))}return t.toDataURL()}function i(){(G=X.w=X.m=new O).Jc(),U=new Wb,F=kc.scale(.5),H=42,Sa=0}function c(){var t=G.M;t!==X.M&&(X.M=t),P[0]&&4&P[0][13]&&(2===L||3===L?X.location.reload():0!==L&&2!==L||(L=1,G.Yc())),t&&(X.sd=g,F=F.ea(t.g,.1),t.C()?L=2:(24<=((t=t.xb("Meat"))?t.l:0)&&g.N(5),g.count()===g.length&&(L=3))),H=fa(H*(1-Yb/10),3,700),G&&G.update()}function o(){}function b(){}function l(){const t=G.M,s=new w,i=M.width/2,a=M.height/2;var h=M.width/8e3;if(2===L)Sb("YOU DIED",y(i,a-90),90,new w(1,0,0),4),Sb("Press Enter to restart",y(i,a),40,new w(1,.5,.5),4);else if(0===L)Vb(U,"BIT BUTCHER",F.add(y(0,6)),h),Vb(U,"Press Enter to start",F.add(y(0,.4)),h/2);else if(1===L||3===L&&t){var e=t,n=M.width/2,r=e.H[e.ba];for(Vb(U,`${r?r.name:"Nothing"} equipped, 1-9: Equip item, E: Action`,qb(y(n,M.height-40)),2/H),r=1;r<=10;r++){const o=y(n-300+60*r,M.height-100);var c=r%10;Qb(o,y(50,70),c===e.ba?new w(.9,.9,.9,.3):new w(.1,.1,.1,.3)),(c=e.H[c])&&(Sb(c.J,o.add(y(0,-6)),28),Vb(U,""+c.l,qb(o.add(y(5,14))),2/H))}g.forEach((t,i)=>Sb(`[${t[1]?"X":" "}] `+t[0],y(M.width-300,100+30*i),18,t[1]?new w(.4,1,.4,.5):s,4,new w(0,0,0,t[1]?.5:1),"left")),h=85<t.G?0:1,h=new w(1,h,h,.8),Qb(y(i,40),y(Math.max(0,100-t.G)/100*500,2),h),Sb("Age: "+Math.ceil(t.G),y(i,40),20,h,4),3===L&&(Vb(U,"YOU WIN",F.add(y(0,5)),.2),Sb("Press Enter to play again",y(i,a-80),40,s,4))}}let u;const d=(t,i)=>{if(!ec)throw Error("no Sound");if(!(u=u||{hit:new ec([,,183,.03,.02,.09,,1.49,-1.8,,,,-.01,1.8,-1,.1,,.36,.08,.25]),attack:new ec([,,493,.01,.09,0,4,1.14,,,,,,,,.1,,.1,.01]),craft:new ec([,,7,.03,.28,.44,2,1.44,,-.3,20,.11,.04,,,.1,,.55,.29]),dud:new ec([.8,,112,,.07,.05,1,2.26,-.6,,,,,1.8,,.1,.2,.98,.1,.1]),powerup:new ec([,,1152,,.04,.17,,1.21,,,744,.08,,,,,,.91,.03]),pickup:new ec([1.05,,172,.02,,.17,2,.02,,,-409,.06,,,,.1,,.55,,.19]),walk:new ec([.5,.1,70,,,.01,4,,,,-9,.1,,,,,,.5]),consume:new ec([1.2,,16,.07,.18,.34,1,.38,-.1,-5.6,49,.15,.02,-.1,36,.1,,.39,.14])}))throw Error("no sounds");u[t]?u[t].play(i):console.warn("No sound",t,"in",u)};let g=[["Move (W,A,S,D or Arrows)"],["Pick up and equip knife (#)"],["Stab an animal"],["Breed animals (herbs)"],["Make forbidden wine (10 blood)"],["Collect 24 meat"],["Eat a meaty, home-cooked meal"]],f=g;f.N=t=>{f[t][1]||d("powerup"),f[t][1]=(f[t][1]||0)+1},f.count=()=>f.reduce((t,i)=>t+(i[1]?1:0),0);const v=ma;class x extends Lb{constructor(t={}){var{g:t=y(),size:i=y(1),j:s=1,A:a,angle:h,m:e,ha:n=0,name:r=ma(999),s:c=0}=t;super(t,i,s,a,h),this.name=r,this.m=e,this.facing=k,this.direction=4,this.Z=new B,this.s=c,this.ha=n,this.O=y(1)}setDirection(){this.direction=Math.round(this.facing<0?4+4*(k+this.facing)/k:4*this.facing/k)%8}va(t){if(this.C()||this.Z.active())return 0;this.Z.set(1);for(var i of this.children)i.Z&&i.Z.set(1);return t=ea(this.s-t,0),i=this.s-t,(this.s=t)||this.Aa(),i}C(){return!this.s}Aa(){Db(this)}update(){var t;super.update(),this.setDirection(),this.C()||null==this.Z.time?this.Ga=new w(0,0,0,0):(t=.5*ia(this.Z.get(),.15,0),this.Ga=new w(t,.1,.1,.5))}Sa(){return this.m.X.find(t=>t.Mc&&!t.C())}}class m extends x{constructor(i){super(i),this.pa=new B,this.ma=new B,this.Za=new B(t(10)),this.hb=new B,this.Ja=new B,this.Wb=new B,this.Ib=new B,this.Qa=null,this.P=new B,this.wb=new B,this.color=za(t()),this.Ia=i.Ia||null,this.species=i.species||a(this.Ia)||s(this.color),this.T=10,this.s=2,this.Kb=.14,this.Hb=7,this.Lb=1/0,this.yb=this.Vb=!1,Hb(this,1),this.na=this.oa=this.G=0,this.Fa=1,this.D=y(),this.S=y(),this.max=y(window.gb),this.H=[,,,,,,,,,,],this.ba=-1,this.W=this.u=null,Gb(this,this.Pa=new x({j:9})),this.Pa.la=y(0,1.2),this.bb(),Gb(this,this.Ka=new uc(y(),0,0,0,0,k,void 0,void 0,new w(1,.2,.2),new w(.5,.1,.1),new w(.4,.1,.1),new w(.4,.2,.2,.3),5,.2,.1,.07,.1,.95,.95,1,k,.01,.2,1),y(),0),this.Ka.F=.5}bb(t){this.Pa.O=y(t?1:0),t&&(this.Pa.j={estrous:9,fear:10,anger:11,dead:12}[t])}rd(){var t,i;this.C()?this.Qa="dead":(t=-1*this.P.get(),i=-1*this.wb.get(),this.Qa=0<t&&i<t?"estrous":0<i?"fear":null),this.bb(this.Qa)}va(i,s){return(i=super.va(i,s))<=0?0:(d("hit",this.g),s&&s.g&&(this.h=this.h.add(this.g.v(s.g).scale(t(.4,.8)))),this.jb(),this.ma.time=void 0,i)}jb(){this.Ja.active()||(this.Ja.set(this.C()?.5:.2),this.Ka.wa=100)}hc(){this.Ja.active()||(this.Ka.wa=0)}wc(s){var t=this.H.findIndex((t,i)=>t&&t.name===s&&(t.l||0)<(t.stack||0)&&0<i);return-1!==t?t:this.H.findIndex((t,i)=>!t&&0<i)}xb(i){var t=this.H.findIndex(t=>t&&t.name===i);return t<0?null:this.H[t]}R(){return this.H[this.ba]}Nb(t){var i,s;"number"!=typeof i&&(i=this.wc(t.name)),!t||i<1||9<i||((s=this.H[i])&&s.name===t.name&&(s.l||0)<(s.stack||0)?s.l=(s.l||0)+1:this.H[i]=t,d("pickup",this.g))}throw(){}qd(t){this.oc(this.ba===t?-1:t)}oc(t){t<-1||9<t||(this.ba=t,t=this.H[this.ba],this.u&&(this.u.O=y()),t?("Butcher knife"===t.name&&g.N(1),t.aa||(t.aa=new x(t),Gb(this,t.aa,y(-.2,.2))),t.l||(t.aa.O=y()),this.u=t.aa):this.u=null)}Dc(){var t=this.R();return t&&t.weight||0}Eb(){var t=this.R();if(t)return t.ib||0}attack(){d("attack",this.g)}Cb(t=[],a){let h;return t.reduce((t,i)=>{var s=wa(i.g,a)**.5;return s<t?(h=i,s):t},1/0),h}vc(t=this.g){var i=this.m.X.filter(t=>!t.C()&&t!==this);const s=this.u;return i=i.filter(t=>la(t.g,t.size,s.g,s.size)),this.Cb(i,t)}uc(t=this.g){var i=this.R();(t=this.vc(t))&&i.l?(this.Ma(i,!0),t.s+=1,t.P.set(10),d("craft",this.g)):d("dud",this.g)}ob(t){const i=this.R();"wine"===t?"Blood"!==i.name||i.l<10?d("dud",this.g):(i.l-=10,g.N(4),this.m.I("Blood wine",this.g,2),d("craft")):"meal"===t&&("Meat"!==i.name||i.l<24?d("dud",this.g):(i.l-=24,this.m.I("Meal",this.g,2),d("craft",this.g)))}La(){const t=this.m,i=this.u.g.B(),s=29!==t.Ab(i).j;if(s){var a=this.xb("Stone");if(!this.Ma(a,!0))return void d("dud")}d("attack"),s||t.I("Stone",i,1),t.Rb(i,s?{j:29,sa:!0}:{j:4,sa:!1})}Na(){const t=this.m,i=this.u.g.B();var s=25===(s=t.Ab(i)).j||26===s.j;d("attack"),s&&t.I("Stone",i,2,ma(1,3)),t.Rb(i,{j:4,sa:!1})}Ma(t,i){return!t||t.l<=0?0:(--t.l,t.fb&&(this.s+=1,this.G=Math.round(Math.max(1,this.G-(t.fb||0)-this.G/10))),"Meal"===t.name&&g.N(6),i||d("consume",this.g),1)}Ba(){this.Ib.active()||(this.Ib.set(1),this.h=this.h.add(ra(y(),this.facing,.5)))}action(t){if(!this.pa.active()){var i=this.R();if(this.pa.set(.25),i)return i.Ba&&this.Ba(i.Ba),i.ha?this.attack():i.ib?this.uc(t):("Blood"===i.name&&this.ob("wine"),"Meat"===i.name&&this.ob("meal"),void(i.La?this.La():i.Na?this.Na():i.nb&&this.Ma(i)))}}gd(){this.Za.active()||(this.Za.set(t(2,20)),this.W=(wa(this.g,this.m.Y)**.5>this.m.size.x/3?this.m.Y:this.g).add(y(t(-10,10),t(-10,10))),this.Fa=t(1))}Sc(){var t;this.ma.active()||(t=this.Vc(),this.P.active()?this.Uc():t||this.Tc())}Vc(){var i,s;return!this.Vb||!(i=this.m.X.find(t=>t.jd&&!t.C()&&!t.Eb()&&t!==this))||(s=wa(i.g,this.g)**.5)>this.Hb?0:(this.ma.set((s=s<6)?.5:t(.5,2)),this.wb.set(1),s&&(i=this.g.v(i.g).normalize(7),this.Va(this.g.add(i))),s)}Va(t=null,i){i&&this.Za.set(60),this.W=t,this.Fa=1}Tc(){var i,s;!this.yb||!(i=this.Sa())||(s=wa(i.g,this.g)**.5)>this.Hb||4<s||(s=i.R())&&i.Eb()&&s.aa&&(this.W=s.aa.g.add(ra(y(),t(2*k),t(1,2))))}Uc(){var t;this.P.active()&&(this.ma.set(1),(t=this.m.X.filter(t=>!t.C()&&t.P.active()&&t!==this)).length&&(t=this.Cb(t,this.g))&&(la(t.g,t.size,this.g,this.size)?this.$c(t):this.W=t.g))}$c(t){this.ma.set(5),t.P.time=void 0,this.P.time=void 0,g.N(3),this.m.Jb(this.g,[this.species,t.species])}Fc(){this.hb.active()||(this.hb.set(5),this.G+=1,this.Kc()&&this.va(1,this))}Kc(){return this.G>this.Lb}Rc(){var t,i;this.C()||((i=(t=this.S.B()).x||t.y)&&this.Va(null,!0),this.Sc(),this.gd(),this.D=this.h.B(),i?(t=t.scale(.04*this.Fa),this.D=this.D.add(t),this.Wb.active()||(d("walk",this.g),this.Wb.set(.21))):this.W&&.75<wa(this.g,this.W)**.5&&(this.D=this.D.ea(this.W.v(this.g),.5)),t=this.Kb*this.Fa*(1-this.Dc()),this.D.x=fa(this.D.x,-t,t),this.D.y=fa(this.D.y,-t,t),this.h=y((this.h.x>t||this.h.x<-t?this.h:this.D).x,(this.h.y>t||this.h.y<-t?this.h:this.D).y),t=this.h.length(),this.oa+=3.5*this.D.length(),this.oa%=1e4,this.na+=.5*t,this.na=.01<t?(this.na%1+1)%1:0,this.facing=this.h.angle(),this.Fc())}update(){this.rd(),this.Rc(),this.hc();const t=y(.9999);0===this.S.x&&(t.x=.9),0===this.S.y&&(t.y=.9),this.h=this.h.multiply(t),super.update()}fa(){const i=this.g.add(y(0,.05*Math.sin(this.na*k)));[[1,.2],[.9,.1]].forEach(t=>{Nb(i.add(y(0,.75*-this.size.y)),y(this.size.x*t[0],t[1]),-1,Qa,new w(0,0,0,.1),this.angle,0,0)}),h(lb,i,this.species,this.direction,this.oa)}}class p extends m{constructor(t){super(t),this.Mc=!0,this.s=5,this.Kb=.2,this.T=10,this.G=18,this.Lb=100}update(){Xb(2)&&this.Va(pb,!0),[48,49,50,51,52,53,54,55,56,57].forEach(t=>{P[0]&&2&P[0][t]&&this.qd(t-48)}),(Xb(81)||$b(1))&&this.throw(),(Xb(69)||Xb(0)||$b(0))&&this.action(pb),((this.S=Zb?bc[0]&&bc[0][0]||y():y(Xb(39)-Xb(37),Xb(38)-Xb(40)))&&this.S.x||this.S.y)&&g.N(0),this.jd=!0,super.update();const t=this.u;var i,s;t&&(i=this.pa.active()?1.1:.8,s=this.R(),t.O=y(s.l?this.pa.active()?1.2:1:0),t.la=ra(y(),this.facing,i),i=y(),0===this.direction?i=y(.35,-.1):1===this.direction?i=y(.2,-.2):7===this.direction&&(i=y(-.2,-.1)),t.la=t.la.add(i),t.Gb=this.facing+1.2*k+(s.Wa||0),t.T=t.g.y<this.g.y?11:9)}}class A extends m{constructor(t){super(t),this.yb=this.Vb=!0}Aa(){d("hit",this.g),this.s=0,this.jb(),this.bb("dead"),setTimeout(()=>this.m.I("Meat",this.g,1),500),setTimeout(()=>super.Aa(),4e3)}update(){super.update();const t=this.Sa();if(!this.C()&&t&&t.u&&t.u.ha&&la(this.g,this.size,t.u.g,t.u.size)&&(g.N(2),this.va(t.u.ha,t.u))){const i={...this.m.Bb("Blood")};i.l=ma(1,3),t.Nb(i)}}}class J extends x{constructor(t){super(t),this.za=t.za,this.j=this.za.j,this.vb=new B}update(){super.update();const t=this.Sa();this.C()?(this.O=y(1-Ea(this.vb)),t&&(this.g=this.g.ea(t.g,.1))):t&&la(this.g,this.size,t.g,t.size)&&(t.Nb(this.za),this.s=0,this.vb.set(.4),setTimeout(()=>this.Aa(),400))}}class W extends x{constructor(t){super(t),this.ab=new B,this.Ya=new B,Hb(this,0),this.j=1,this.Xa=this.g.B()}update(){var i;super.update(),this.ab.active()||(i=wa(this.g,this.Xa)**.5,this.Ya.active()?1<i?(this.h=this.h.ea(this.Xa.v(this.g),.9),this.h=xa(this.h,4)):(this.h=this.h.scale(.1),this.ab.set(10),this.Ya.time=void 0):.2<t()?(this.m.M&&this.m.I("Herb",this.g,1),this.ab.set(10)):(this.Xa=this.m.Db(),this.Ya.set(5)))}}const C=[1,2,27,3,28,4],D=t=>(t=1e4*Math.sin(t))-Math.floor(t);class j{constructor(t){this.size=y(200,200),this.Y=this.size.scale(.5),this.key=j.getKey(t),this.g=t,this.seed=Math.round(1e5*D(1e4*t.y+t.x+1235)),this.nc=this.zc(),this.pd=this.Ac(),this.pb={},console.log(this)}static getKey(t){return t.x+","+t.y}zc(){var i=[];ta=this.seed;for(let t=999;t--;){var s=i,a=s.push;ta=(ta=(ta^=ta<<13)^ta>>>17)^ta<<5,a.call(s,1+-1*ca(ta%1e9)/1e9)}return i}ja(t){return this.nc[t%999]}Bc(t){return y(200*this.ja(t),200*this.ja(t+1))}Cc(t,i=1,s=0){return s+(i-s)*this.ja(t)}ya(t,i=1,s=0){return 0|this.Cc(t,i,s)}Ac(){const i=[{g:y(100,100),Tb:0,weight:1}];for(let t=200;t--;){var s=4*t;i.push({g:this.Bc(s),Tb:this.ya(3+s,C.length),weight:.2+.8*this.ja(4+s)})}return i}Wc(t){const i=this.size.x,s=this.size.y,a=y();for(a.x=i;a.x--;)for(a.y=s;a.y--;)t(a,a.x+a.y*i)}Ec(a){let h;return this.pd.reduce((t,i)=>{var s=wa(i.g,a)**.5*i.weight;return s<t?(h=i.Tb,s):t},1/0),h}zb(t){var i,s,a,h,e;return(i=this.pb[j.getKey(t)])?{...i}:(i=Math.round(999*D(t.x+200*t.y)),s=this.ja(i),a=this.Ec(t),t=(e=((h=28===(a=C[a]))?.975:.991)<s)&&(h||wa(t,this.Y)**.5>200/3.5),s<.1?a=1:s<.2?a+=this.ya(++i,-1,1):s<.4&&(a=this.ya(++i,1,5)),{j:a=t?25+this.ya(++i,2):a,color:t=e&&!t?sa():void 0,sa:e})}mc(t,i={}){this.pb[j.getKey(t)]=i}}class O{constructor(){this.size=y(200,200),this.Y=this.size.scale(.5),this.items=[],this.X=[],this.md=[],this.Nc=[{name:"Meat",j:7,l:1,stack:64,J:"🍖"},{name:"Blood",j:6,l:1,stack:64,J:"🩸"},{name:"Butcher knife",type:"w",j:5,l:1,stack:8,ha:1,Ba:1,J:"🔪"},{name:"Herb",j:8,l:1,stack:64,ib:1,J:"🌿",Yb:-.6,Wa:k/2},{name:"Blood wine",j:13,l:1,stack:64,fb:10,nb:1,J:"🍷"},{name:"Meal",j:14,l:1,stack:8,fb:1,nb:1,J:"🍲"},{name:"Hammer",j:17,l:1,stack:8,La:1,weight:.5,J:"🔨",Wa:k},{name:"Pickaxe",j:15,l:1,stack:8,Na:1,weight:.5,J:"⛏️",Wa:k},{name:"Stone",j:19,l:1,stack:64,J:"🧱"}],this.Ub=[],this.kb=y(),this.lb={},this.M=0,this.ka}Yc(){this.M=new p({g:this.Y.B(),m:this}),this.X.push(this.M)}Bb(i){return this.Nc.find(t=>t.name===i)}Db(){return y(t(this.size.x),t(this.size.y))}I(i,s,a=0,h=1){var e="string"==typeof i?this.Bb(i):i;for(e||console.error("Cannot make item",i),i=h;i--;)h=a?s.add(y(t(-a,a),t(-a,a))):s.B(),this.items.push(new J({za:e,g:h,s:1,m:this,angle:(e.Yb||0)+t(-.2,.2)}))}Jb(t,i){this.X.push(new A({j:0,g:t,m:this,Ia:i}))}Zc(){this.md.push(new W({g:this.Db(),m:this}))}Xc(){var t=new j(this.kb);return this.lb[t.key]=t}Ua(){var t=j.getKey(this.kb);return this.lb[t]||this.Xc()}Xb(t){return y(Math.floor(t.x),Math.floor(t.y))}Ab(t){return this.Ua().zb(this.Xb(t))}Rb(t,i){t=this.Xb(t),qc(this.ka),this.Qb(t,i,!0),i=this.ka,zb(1),[K,lb,F,H]=i.Pb}Qb(t,i={},s){var a=i.j,h=i.color,e=i.sa;this.Ua().mc(t,i),e?mc(t,1):s&&mc(t,0),this.ka.setData(t,new nc(a,ma(4),ma(2),h),s)}Jc(){var i=this.size;const s=this.Ua();let a;for(a=20;a--;)for(let i=2;i--;)this.Jb(y(t(200),t(200)));const h=i=>this.Y.add(ra(y(),t(2*k),i));this.I("Butcher knife",h(9)),this.I("Pickaxe",h(34)),this.I("Hammer",h(35)),[20,21,100,t(20,100)].forEach(t=>this.I("Herb",h(t))),this.Zc(),lc(i.B()),this.ka=new rc(i),i=new rc(i),s.Wc(t=>{this.Qb(t,s.zb(t))}),this.Ub=[this.ka,i],this.Ub.forEach(s=>{qc(s,1);for(let i=s.size.x;i--;)for(let t=s.size.y;t--;)oc(s,y(i,t));zb(1),[K,lb,F,H]=s.Pb})}update(){const s=this.M;if(s){let t,i;s.g.x>this.size.x?t=0:s.g.x<0&&(t=this.size.x),s.g.y>this.size.y?i=0:s.g.y<0&&(i=this.size.y),void 0!==t&&(s.g.x=t,F=s.g),void 0!==i&&(s.g.y=i,F=s.g)}}}const E=window.gb||24;let N,I=0,V=ma;const Y=(t,i,s,a,h,e=E,n=E)=>{N.fillStyle="#"+t+i+s,N.fillRect(a,h,e,n)},X=window;let L=0;X.gb=24;let G,U;(async()=>{var s;Qa=y(24),jb(i,c,o,b,l,await new Promise(t=>{const i=new Image;i.onload=()=>t(r(document)),s?i.src=s:i.onload()}))})()}();