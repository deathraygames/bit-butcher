"use strict";const k=Math.PI,ca=t=>t<0?-t:t,da=(t,i)=>t<i?t:i,ea=(t,i)=>i<t?t:i,fa=(t,i=0,s=1)=>t<i?i:s<t?s:t,ia=(t,i=0,s=1)=>s-i?fa((t-i)/(s-i)):0,ka=(t,i=0,s=1)=>i+fa(t)*(s-i),la=(t,i,s,a)=>2*ca(t.x-s.x)<i.x+a.x&2*ca(t.y-s.y)<i.y+a.y,t=(t=1,i=0)=>i+(t-i)*Math.random(),ma=(i=1,s=0)=>0|t(i,s),oa=(i=1)=>0<i?na(i*t(0/i,1)**.5):new u,na=(i=1)=>ra(new u,t(2*k),i),sa=(i=new w,s=new w(0,0,0,1),a)=>a?i.ea(s,t()):new w(t(i.r,s.r),t(i.o,s.o),t(i.b,s.b),t(i.a,s.a));let ta=1;const y=(t=0,i)=>null==t.x?new u(t,null==i?t:i):new u(t.x,t.y);function ra(t,i=0,s=1){return t.x=s*Math.sin(i),t.y=s*Math.cos(i),t}function wa(t,i){return(t.x-i.x)**2+(t.y-i.y)**2}function xa(t,i=1){var s=t.length();return i<s?t.scale(i/s):t}function ya(t,i){return 0<=t.x&&0<=t.y&&t.x<i.x&&t.y<i.y}class u{constructor(t=0,i=0){this.x=t,this.y=i}D(){return new u(this.x,this.y)}add(t){return new u(this.x+t.x,this.y+t.y)}u(t){return new u(this.x-t.x,this.y-t.y)}multiply(t){return new u(this.x*t.x,this.y*t.y)}tb(t){return new u(this.x/t.x,this.y/t.y)}scale(t){return new u(this.x*t,this.y*t)}length(){return(this.x**2+this.y**2)**.5}normalize(t=1){var i=this.length();return i?this.scale(t/i):new u(0,t)}angle(){return Math.atan2(this.x,this.y)}rotate(t){var i=Math.cos(t);return t=Math.sin(t),new u(this.x*i-this.y*t,this.x*t+this.y*i)}direction(){return ca(this.x)>ca(this.y)?this.x<0?3:1:this.y<0?2:0}floor(){return new u(Math.floor(this.x),Math.floor(this.y))}ea(t,i){return this.add(t.u(this).scale(fa(i)))}toString(t=3){return`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`}}function za(t=0){var i=new w,s=(t,i,s)=>(s=(s%1+1)%1)<1/6?t+6*(i-t)*s:s<.5?i:s<2/3?t+(i-t)*(2/3-s)*6:t;return i.r=s(1.4-1,1,t+1/3),i.o=s(1.4-1,1,t),i.b=s(1.4-1,1,t-1/3),i.a=1,i}function Da(t){return(255*t.r|0)+(255*t.o<<8)+(255*t.b<<16)+(255*t.a<<24)}class w{constructor(t=1,i=1,s=1,a=1){this.r=t,this.o=i,this.b=s,this.a=a}D(){return new w(this.r,this.o,this.b,this.a)}add(t){return new w(this.r+t.r,this.o+t.o,this.b+t.b,this.a+t.a)}u(t){return new w(this.r-t.r,this.o-t.o,this.b-t.b,this.a-t.a)}multiply(t){return new w(this.r*t.r,this.o*t.o,this.b*t.b,this.a*t.a)}tb(t){return new w(this.r/t.r,this.o/t.o,this.b/t.b,this.a/t.a)}scale(t,i=t){return new w(this.r*t,this.o*t,this.b*t,this.a*i)}ea(t,i){return this.add(t.u(this).scale(fa(i)))}toString(){return`rgb(${255*this.r|0},${255*this.o|0},${255*this.b|0},${this.a})`}}function Ea(t){return null!=t.time?ia(t.time-Fa,t.setTime,0):0}class B{constructor(t){this.time=null==t?void 0:Fa+t,this.setTime=t}set(t=0){this.time=Fa+t,this.setTime=t}active(){return Fa<=this.time}get(){return null!=this.time?Fa-this.time:0}toString(){}}let Ga=y(1920,1200),Ha=y(),Qa=y(16),Ra=y(1),Sa=0,F=y(),H=ea(Qa.x,Qa.y);const Xa=1/60;let Ya=[],Za=[],$a=0,Fa=0,ab=0,db=0,gb=0,hb,ib;function jb(t,a,h,e,n,i){kb.onerror=kb.onload=()=>{ib=y(.3).tb(hb=y(kb.width,kb.height)),document.body.style="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none;-moz-user-select:none",document.body.appendChild(K=document.createElement("canvas")),lb=K.getContext("2d"),K.style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)",mb(),document.body.appendChild(M=document.createElement("canvas")),N=M.getContext("2d"),M.style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)",t(),r()};const r=(t=0)=>{var i=t-db;for(db=t,ab+=i/1e3,gb=da(gb+i,50),Ha.x?(M.width=K.width=Ha.x,M.height=K.height=Ha.y,t=innerWidth/innerHeight,i=K.width/K.height,K.style.width=M.style.width=t<i?"100%":"",K.style.height=M.style.height=t<i?"":"100%",nb&&(nb.style.width=K.style.width,nb.style.height=K.style.height)):(M.width=K.width=da(innerWidth,Ga.x),M.height=K.height=da(innerHeight,Ga.y)),ob=y(K.width,K.height),t=0,gb<0&&-9<gb&&(t=gb,gb=0);0<=gb;gb-=1e3/60)document.hasFocus()||(P=[[]]),pb=qb(tb),ub(),a(),vb(),h(),wb();gb+=t,xb(),e(),Ya.sort((t,i)=>t.U-i.U);for(const s of Ya)s.aa||s.fa();n(),yb(),zb(),requestAnimationFrame(r)};i?kb.src=i:kb.onload()}function xb(){ob=y(K.width,K.height),lb.imageSmoothingEnabled=!1;var t=K.width,i=K.height,s=F.x,a=F.y,h=H;R.viewport(0,0,nb.width=t,nb.height=i),R.clear(16384),R.bindTexture(3553,Ab),R.useProgram(Bb),Cb=void 0,t=2*h/t,i=2*h/i,R.uniformMatrix4fv(R.getUniformLocation(Bb,"m"),0,new Float32Array([t,0,0,0,0,i,0,0,1,1,-1,1,-1-t*s,-1-i*a,0,0]))}function vb(){Za=Ya.filter(t=>t.ob);const s=t=>{if(!t.aa){t.update();for(const i of t.children)s(i)}};for(const t of Ya)t.parent||s(t);Ya=Ya.filter(t=>!t.aa),Fa=++$a/60}function Db(t){if(!t.aa){t.aa=1,t.parent&&t.parent.removeChild(t);for(const i of t.children)Db(i,i.parent=0)}}function Gb(t,i,s=y(),a=0){i.parent||t.children.includes(i),t.children.push(i),i.parent=t,i.ma=s.D(),i.Jb=a}function Hb(t,i=0){t.ob=i,t.Ib=0,t.ga=1}class Lb{constructor(t=y(),i=Ra,s=-1,a=Qa,h=0,e,n=0){this.g=t.D(),this.size=i,this.ba,this.j=s,this.v=a,this.angle=h,this.color=e,this.Ga,this.i=1,this.sa=this.K=.99,this.F=0,this.Ta=.8,this.ca=1,this.U=n,this.h=new u,this.Ha=0,this.Vb=Fa,this.children=[],this.ga=1,Ya.push(this)}update(){var t=this.parent;if(t)this.g=this.ma.multiply(y(t.M?-1:1,1)).rotate(-t.angle).add(t.g),this.angle=(t.M?-1:1)*this.Jb+t.angle;else if(this.h.x=fa(this.h.x,-1,1),this.h.y=fa(this.h.y,-1,1),t=this.g.D(),this.g.x+=this.h.x*=this.K,this.g.y+=this.h.y=this.K*this.h.y+Sa*this.ca,this.angle+=this.Ha*=this.sa,this.i){var i,s,a,h,e,n,r,c=this.h.y<0;if(this.da&&(i=this.da.h?this.da.h.x:0,this.h.x=i+(this.h.x-i)*this.Ta,this.da=0),this.ob)for(var o of Za)!this.Ib&!o.Ib||o.aa||o.parent||o==this||la(this.g,this.size,o.g,o.size)&&(la(t,this.size,o.g,o.size)?(i=(s=(i=t.u(o.g)).length())<.01?na(.001):i.scale(.001/s),this.h=this.h.add(i),o.i&&(o.h=o.h.u(i))):(i=this.size.add(o.size),s=2*(t.y-o.g.y)>i.y+Sa,a=2*ca(t.y-o.g.y)<i.y,h=2*ca(t.x-o.g.x)<i.x,!s&&!h&&a||(this.g.y=o.g.y+(i.y/2+.001)*(t.y-o.g.y<0?-1:1),o.da&&c||!o.i?(c&&(this.da=o),this.h.y*=-this.F):o.i&&(e=(this.i*this.h.y+o.i*o.h.y)/(this.i+o.i),n=o.h.y*(o.i-this.i)/(this.i+o.i)+2*this.h.y*this.i/(this.i+o.i),r=ea(this.F,o.F),this.h.y=ka(r,e,this.h.y*(this.i-o.i)/(this.i+o.i)+2*o.h.y*o.i/(this.i+o.i)),o.h.y=ka(r,e,n))),s||!a&&h||(this.g.x=o.g.x+(i.x/2+.001)*(t.x-o.g.x<0?-1:1),o.i?(i=(this.i*this.h.x+o.i*o.h.x)/(this.i+o.i),s=o.h.x*(o.i-this.i)/(this.i+o.i)+2*this.h.x*this.i/(this.i+o.i),a=ea(this.F,o.F),this.h.x=ka(a,i,this.h.x*(this.i-o.i)/(this.i+o.i)+2*o.h.x*o.i/(this.i+o.i)),o.h.x=ka(a,i,s)):this.h.x*=-this.F)));this.ga&&Mb(this.g,this.size,this)&&!Mb(t,this.size,this)&&(o=Mb(new u(this.g.x,t.y),this.size,this),!Mb(new u(t.x,this.g.y),this.size,this)&&o||(this.da=c,this.h.y*=-this.F,(c=(t.y-this.size.y/2|0)-(t.y-this.size.y/2))<0&&c>this.K*this.h.y+Sa*this.ca&&(this.h.y=this.K?(c-Sa*this.ca)/this.K:0),this.g.y=t.y),o&&(this.g.x=t.x,this.h.x*=-this.F))}}fa(){Nb(this.g,this.ba||this.size,this.j,this.v,this.color,this.angle,this.M,this.Ga)}removeChild(t){t.parent==this&&this.children.includes(t),this.children.splice(this.children.indexOf(t),1),t.parent=0}toString(){}}const kb=new Image;let K,lb,M,N,ob=y();const qb=t=>t.add(y(.5)).u(ob.scale(.5)).multiply(y(1/H,-1/H)).add(F),Ob=t=>t.u(F).multiply(y(H,-H)).add(ob.scale(.5)).u(y(.5));function Nb(t,i=y(1),s=-1,a=Qa,h=new w,e=0,n,r=new w(0,0,0,0)){var c,o,b;s<0||!kb.width?Pb(t.x,t.y,i.x,i.y,e,0,0,0,0,0,Da(h)):(b=s%(c=hb.x/a.x|0)*(o=a.x/hb.x),s=(s/c|0)*(a=a.y/hb.y),Pb(t.x,t.y,n?-i.x:i.x,i.y,e,b+ib.x,s+ib.y,b-ib.x+o,s-ib.y+a,Da(h),Da(r)))}function Qb(t,i,s,a){Nb(t,i,-1,Qa,s,a,0,0)}function Rb(t,i=y(1),s){var a=Qa;Nb(qb(t),i.scale(1/H),-1,a,s,void 0,0,0)}function Sb(t,i){var s=y(.055),a=lb;t=Ob(t),s=s.scale(H),a.save(),a.translate(t.x+.5|0,t.y-.5|0),a.rotate(0),a.scale(s.x,s.y),i(a),a.restore()}function Tb(t,i,s=1,a=new w,h=0,e=new w(0,0,0),n="center"){N.fillStyle=a,N.lineWidth=h,N.strokeStyle=e,N.textAlign=n,N.font=s+"px arial",N.textBaseline="middle",N.lineJoin="round",i=i.D(),(t+"").split("\n").forEach(t=>{h&&N.strokeText(t,i.x,i.y),N.fillText(t,i.x,i.y),i.y+=s})}let Ub;function Vb(r,t,c,o=4){const b=r.context,l=(b.save(),b.imageSmoothingEnabled=!1,r.v),u=l.add(r.ed).scale(o),d=r.image.width/r.v.x|0;t.split("\n").forEach((i,s)=>{var a=i.length*l.x*o/2|0;for(let t=i.length;t--;){((h=i[t].charCodeAt())<32||127<h)&&(h=127);var h=(e=r.pd+h-32)%d,e=e/d|0,n=c.add(y(t,s).multiply(u));b.drawImage(r.image,h*l.x,e*l.y,l.x,l.y,n.x-a,n.y,l.x*o,l.y*o)}}),b.restore()}function Wb(t,i,s,a=1){Vb(t,i,Ob(s).floor(),a*H|0)}class Xb{constructor(){var t=y(8),i=y(0,1),s=N;Ub||((Ub=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAYAQAAAAA9+x6JAAAAAnRSTlMAAHaTzTgAAAGiSURBVHjaZZABhxxBEIUf6ECLBdFY+Q0PMNgf0yCgsSAGZcT9sgIPtBWwIA5wgAPEoHUyJeeSlW+gjK+fegWwtROWpVQEyWh2npdpBmTUFVhb29RINgLIukoXr5LIAvYQ5ve+1FqWEMqNKTX3FAJHyQDRZvmKWubAACcv5z5Gtg2oyCWE+Yk/8JZQX1jTTCpKAFGIgza+dJCNBF2UskRlsgwitHbSV0QLgt9sTPtsRlvJjEr8C/FARWA2bJ/TtJ7lko34dNDn6usJUMzuErP89UUBJbWeozrwLLncXczd508deAjLWipLO4Q5XGPcJvPu92cNDaN0P5G1FL0nSOzddZOrJ6rNhbXGmeDvO3TF7DeJWl4bvaYQTNHCTeuqKZmbjHaSOFes+IX/+IhHrnAkXOAsfn24EM68XieIECoccD4KZLk/odiwzeo2rovYdhvb2HYFgyznJyDpYJdYOmfXgVdJTaUi4xA2uWYNYec9BLeqdl9EsoTw582mSFDX2DxVLbNt9U3YYoeatBad1c2Tj8t2akrjaIGJNywKB/7h75/gN3vCMSaadIUTAAAAAElFTkSuQmCC"),this.image=Ub,this.v=t,this.ed=i,this.pd=0,this.context=s}}const Yb=(t,i=0)=>P[i]&&1&P[i][t]?1:0;let pb=y(),tb=y(),Zb=0,$b=0;const ac=(t,i=0)=>Yb(t,i+1);let P=[[]];function wb(){for(const t of P)for(const i in t)t[i]&=1;Zb=0}onkeydown=t=>{t.repeat||(P[$b=0][bc(t.keyCode)]=3)},onkeyup=t=>{P[0][bc(t.keyCode)]=4};const bc=t=>87==t?38:83==t?40:65==t?37:68==t?39:t,cc=(onmousedown=t=>{P[$b=0][t.button]=3,onmousemove(t),t.button&&t.preventDefault()},onmouseup=t=>P[0][t.button]=2&P[0][t.button]|4,onmousemove=t=>{var i;return t=K?(i=K.getBoundingClientRect(),y(K.width,K.height).multiply(y(ia(t.x,i.left,i.right),ia(t.y,i.top,i.bottom)))):y(),tb=t},onwheel=t=>t.ctrlKey||(Zb=t.deltaY<0?-1:1),oncontextmenu=()=>!1,[]);function ub(){if(navigator.getGamepads&&document.hasFocus()){var i=navigator.getGamepads();for(let t=i.length;t--;){var s=i[t];const e=P[t+1]||(P[t+1]=[]),n=cc[t]||(cc[t]=[]);if(s){for(var a=t=>.3<t?ia(t,.3,.8):t<-.3?-ia(-t,.3,.8):0,h=0;h<s.axes.length-1;h+=2)n[h>>1]=xa(y(a(s.axes[h]),a(-s.axes[h+1])));for(a=s.buttons.length;a--;)h=s.buttons[a],e[a]=h.pressed?1+2*!ac(a,t):4*ac(a,t),$b|=!t&&h.pressed;(s=y(ac(15,t)-ac(14,t),ac(12,t)-ac(13,t))).x**2+s.y**2&&(n[0]=xa(s))}}}}if(void 0!==window.ontouchstart){let s,a;ontouchstart=ontouchmove=ontouchend=t=>{t.button=0;var i=t.touches.length;return i?(a||dc([ec(...[0,a=1])]),t.x=t.touches[0].clientX,t.y=t.touches[0].clientY,(s?onmousemove:onmousedown)(t)):s&&onmouseup(t),s=i,!t.cancelable}}class fc{constructor(t,i=30,s=.7){this.jd=i,this.qd=s,this.ab=t[1]||0,t[1]=0,this.ic=ec(...t)}play(i,s=1,a=1,h=1){var e=0;if(i){if(e=this.jd){var n=wa(F,i);if(e*e<n)return;s*=ia(n**.5,e,e*this.qd)}e=2*Ob(i).x/K.width-1}return dc([this.ic],s,a+a*this.ab*h*t(-1,1),e)}}let jc;function dc(t,i=1,s=1,a=0){var h,e;if((jc=jc||new(window.AudioContext||webkitAudioContext)).resume(),"running"==jc.state)return h=jc.createBuffer(t.length,t[0].length,44100),e=jc.createBufferSource(),t.forEach((t,i)=>h.getChannelData(i).set(t)),e.buffer=h,e.playbackRate.value=s,e.loop=0,(t=jc.createGain()).gain.value=.5*i,t.connect(jc.destination),(window.StereoPannerNode?e.connect(new StereoPannerNode(jc,{pan:fa(a,-1,1)})):e).connect(t),e.start(),e}function ec(i=1,s=.05,a=220,h=0,e=0,n=.1,r=0,c=1,o=0,b=0,l=0,u=0,d=0,y=0,g=0,f=0,w=0,x=1,m=0,v=0){let p=2*k,M=o*=500*p/44100/44100,A=[],z=(s=a*=(1+s*t(-1,1))*p/44100,0),B=0,F=0,R=1,U=0,S=0,P=0,C,H;for(b*=500*p/44100**3,g*=p/44100,l*=p/44100,u*=44100,d=44100*d|0,H=(h=44100*h+9)+(m*=44100)+(e*=44100)+(n*=44100)+(w*=44100)|0;F<H;A[F++]=P)++S%(100*f|0)||(P=r?1<r?2<r?3<r?Math.sin((z%p)**3):ea(da(Math.tan(z),1),-1):1-(2*z/p%2+2)%2:1-4*ca(Math.round(z/p)-z/p):Math.sin(z),P=(d?1-v+v*Math.sin(p*F/d):1)*(P<0?-1:1)*(P<0?-P:P)**c*i*.5*(F<h?F/h:F<h+m?1-(F-h)/m*(1-x):F<h+m+e?x:F<H-w?(H-F-w)/n*x:0),P=w?P/2+(w>F?0:(F<H-w?1:(H-F)/w)*A[F-w|0]/2):P),C=(a+=o+=b)*Math.cos(g*B++),z+=C-C*y*(1-1e9*(Math.sin(F)+1)%2),R&&++R>u&&(a+=l,s+=l,R=0),!d||++U%d||(a=s,o=M,R=R||1);return A}let kc=[],lc=y();function mc(t){for(lc=t,t=(kc=[]).length=ca(lc.x*lc.y);t--;)kc[t]=0}const nc=(t,i=0)=>{ya(t,lc)&&(kc[(0|t.y)*lc.x+t.x|0]=i)};function Mb(t,i=y(),s){var a=ea(t.x-i.x/2|0,0),h=ea(t.y-i.y/2|0,0),e=da(t.x+i.x/2,lc.x);for(t=da(t.y+i.y/2,lc.y);h<t;++h)for(i=a;i<e;++i){var n=kc[h*lc.x+i];if(n&&(!s||0<n))return 1}}class oc{constructor(t,i=0,s=0,a=new w){this.fb=t,this.direction=i,this.M=s,this.color=a}clear(){this.fb=this.direction=this.M=0,color=new w}}function pc(t,i){var s=i.floor().add(t.g).add(y(.5));qc(t,s,t=>t.clearRect(-.5,-.5,1,1)),null!=(i=t.getData(i)).fb&&Nb(s,y(1),i.fb,t.v,i.color,i.direction*k/2,i.M)}function rc(t,i=0){i&&(t.canvas.width=t.size.x*t.v.x,t.canvas.height=t.size.y*t.v.y),t.Sb=[K,lb,F,H],K=t.canvas,lb=t.context,F=t.size.scale(.5),H=t.v.x,xb()}function qc(t,i,s){var a=y(1);const h=t.context;h.save(),i=i.u(t.g).multiply(t.v),a=a.multiply(t.v),h.translate(i.x,t.canvas.height-i.y),h.rotate(0),h.scale(a.x,a.y),s(h),h.restore()}class sc extends Lb{constructor(t=lc){var i=y(1);for(super(y(),t,-1,Qa,0,void 0,0),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.scale=i,this.Mc,this.data=[],t=this.size,t=ca(t.x*t.y);t--;)this.data.push(new oc)}setData(t,i,s){ya(t,this.size)&&(this.data[(0|t.y)*this.size.x+t.x|0]=i,s&&pc(this,t))}getData(t){return ya(t,this.size)&&this.data[(0|t.y)*this.size.x+t.x|0]}update(){}fa(){var t=Ob(this.g.add(y(0,this.size.y*this.scale.y)));(this.Mc?N:lb).drawImage(this.canvas,t.x,t.y,H*this.size.x*this.scale.x,H*this.size.y*this.scale.y)}}function tc(i){var s=null!=i.Oa.x?new u(t(-.5,.5),t(-.5,.5)).multiply(i.Oa).rotate(i.angle):oa(.5*i.Oa),s=new uc(i.g.add(s),i.j,i.v,i.angle+t(i.Pb,-i.Pb));const a=i.ab;var h=(c=i=>i+i*t(a,-a))(i.gd),e=c(i.eb),n=c(i.md),r=c(i.speed),c=c(i.ac)*(2*(0|t(2))-1);const o=t(i.ub,-i.ub),b=sa(i.mc,i.nc,i.Rb),l=sa(i.kc,i.lc,i.Rb);s.va=b,s.ua=l.u(b),s.h=ra(new u,i.angle+o,r),s.Ha=c,s.Rc=h,s.eb=e,s.nd=n-e,s.Ra=i.Ra,s.K=i.K,s.sa=i.sa,s.F=i.F,s.Ta=i.Ta,s.ca=i.ca,s.ga=i.ga,s.ra=i.ra,s.U=i.U,s.Ea=i.Ea,s.M=t()<.5,s.sb=i.xd,i.fd&&i.fd(s)}class vc extends Lb{constructor(t,i,s=0,a=0,h=100,e=k,n=-1,r=Qa,c=new w,o=new w,b=new w(1,1,1,0),l=new w(1,1,1,0),d=.5,y=.1,g=1,f=.1,x=.05,m=1,v=1,p=0,M=k,A=.1,z=.2,B,F,R=1,U=F?1e9:0){super(t,new u,n,r,i,void 0,U),this.Oa=s,this.vb=a,this.xa=h,this.ub=e,this.mc=c,this.nc=o,this.kc=b,this.lc=l,this.Rb=R,this.gd=d,this.eb=y,this.md=g,this.speed=f,this.ac=x,this.K=m,this.sa=v,this.ca=p,this.Pb=M,this.Ra=A,this.ab=z,this.ga=B,this.ra=F,this.ia=this.Ea=0}update(){if(this.parent&&super.update(),!this.vb||Fa-this.Vb<=this.vb){if(+this.xa){var t=1/this.xa;for(this.ia+=Xa;0<this.ia;this.ia-=t)tc(this)}}else Db(this)}fa(){}}class uc extends Lb{constructor(t,i,s,a){super(t,new u,i,s,a)}fa(){var t=da((Fa-this.Vb)/this.Rc,1),i=this.eb+t*this.nd,i=new u(i,i),s=this.Ra/2,s=new w(this.va.r+t*this.ua.r,this.va.o+t*this.ua.o,this.va.b+t*this.ua.b,(this.va.a+t*this.ua.a)*(t<s?t/s:1-s<t?(1-t)/s:1));if(this.ra&&(Cb=1),this.Ea){var a=this.h.length();const h=this.h.scale(1/a);a*=this.Ea,i.y=ea(i.x,a),this.angle=h.angle(),Nb(this.g.add(h.multiply(y(0,-a/2))),i,this.j,this.v,s,this.angle,this.M)}else Nb(this.g,i,this.j,this.v,s,this.angle,this.M);this.ra&&(Cb=void 0),1==t&&(this.color=s,this.size=i,this.sb&&this.sb(this),this.aa=1)}}let wc=[],xc;function yb(){var t,i;wc.length&&(t=wc[0],i=ab-xc,xc?5<i?wc.shift(xc=0):t.fa():xc=ab)}let nb,R,Ab,Bb,U,W,yc,zc,Cb;function mb(){nb=document.createElement("canvas"),R=nb.getContext("webgl",{antialias:!1}),nb.style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)",Ab=Ac(),document.body.appendChild(nb),Bb=Bc();var t=new ArrayBuffer(9437184);Cc(t.byteLength),U=new Float32Array(t),W=new Uint32Array(t);let e=yc=0;(t=(t,i,s,a,h=0)=>{t=R.getAttribLocation(Bb,t),R.enableVertexAttribArray(t),R.vertexAttribPointer(t,a,i,h,24,e),e+=a*s})("p",5126,4,2),t("t",5126,4,2),t("c",5121,1,4,1),t("a",5121,1,4,1)}function Dc(t,i){return i=R.createShader(i),R.shaderSource(i,t),R.compileShader(i),i}function Bc(){var t=R.createProgram();return R.attachShader(t,Dc("precision highp float;uniform mat4 m;attribute vec2 p,t;attribute vec4 c,a;varying vec2 v;varying vec4 d,e;void main(){gl_Position=m*vec4(p,1,1);v=t;d=c;e=a;}",35633)),R.attachShader(t,Dc("precision highp float;varying vec2 v;varying vec4 d,e;uniform sampler2D s;void main(){gl_FragColor=texture2D(s,v)*d+e;}",35632)),R.linkProgram(t),t}function Cc(t){var i=R.createBuffer();R.bindBuffer(34962,i),R.bufferData(34962,t,35048)}function Ac(){var t,i=kb;if(i&&i.width)return t=R.createTexture(),R.bindTexture(3553,t),R.texImage2D(3553,0,6408,6408,5121,i),R.texParameteri(3553,10241,9728),R.texParameteri(3553,10240,9728),R.texParameteri(3553,10242,33071),R.texParameteri(3553,10243,33071),t}function Ec(){var t;yc&&(t=zc?1:771,R.blendFuncSeparate(770,t,1,t),R.enable(3042),R.bufferSubData(34962,0,U.subarray(0,36*yc)),R.drawArrays(4,0,6*yc),yc=0,zc=Cb)}function zb(t){var i=lb;(yc||t)&&(Ec(),t&&i.drawImage(nb,0,0))}function Pb(t,i,s,a,h,e,n,r,c,o=4294967295,b=0){65536!=yc&&zc==Cb||Ec();var l=Math.cos(h)/2,u=Math.sin(h)/2;h=l*s,l*=a,s*=u,a*=u,u=36*yc++,U[u++]=t-h-a,U[u++]=i-l+s,U[u++]=e,U[u++]=c,W[u++]=o,W[u++]=b,U[u++]=t+h+a,U[u++]=i+l-s,U[u++]=r,U[u++]=n,W[u++]=o,W[u++]=b,U[u++]=t-h+a,U[u++]=i+l+s,U[u++]=e,U[u++]=n,W[u++]=o,W[u++]=b,U[u++]=t-h-a,U[u++]=i-l+s,U[u++]=e,U[u++]=c,W[u++]=o,W[u++]=b,U[u++]=t+h-a,U[u++]=i-l-s,U[u++]=r,U[u++]=c,W[u++]=o,W[u++]=b,U[u++]=t+h+a,U[u++]=i+l-s,U[u++]=r,U[u++]=n,W[u++]=o,W[+u]=b}!function(){function z(t){return Math.max(Math.min(Math.round(t),24),0)}function R(t){t.Ba=z(t.x+t.V/2),t.Ca=z(t.y+t.W/2),t.wb=z(t.x+t.V),t.ya=z(t.y+t.W)}function s(t){var i=t?255*t.r:v(180)+20,s=t?255*t.o:v(180)+20,a=(t=t?255*t.b:v(180)+20,v(6,24*.6)),h=v(6,24*.6),e=v(5,24*.6),n=v(0,24-e-2),r=v(6,12),c=v(8,24*.6),o=v(0,24-r-24*.2),b=v(1,3),l=v(1,3),u=v(2,r-4),d=v(1,.5*c),y=v(3,c-4),g=v(1,2),f=v(2,r-u-g),w=v(-4,-1),x=v(-4,3),m=Math.min(a/2,v(1,6));return{cc:[i-20,s-20,t-10],bc:[i-40,s-40,t-20],yc:[i,s,t],qc:0===v(2)?[0,0,0]:[200,200,200],Jc:c,Hc:r,Ic:o,hc:a,ec:h,dc:e,fc:n,uc:b,sc:l,tc:u,rc:d,dd:y,bd:g,cd:f,zc:w,wd:x,Pc:2,Qc:m}}function a(a){var h;if(a)return h=s(),Object.keys(h).forEach(t=>{var s,i;0<v(20)&&(h[t]=(s=t,"number"==typeof(i=(t=a)[0][s])?(t=t.reduce((t,i)=>((i=i[s])<t[0]&&(t[0]=i),i>t[1]&&(t[1]=i),t),[1/0,-1/0]),v(t[0],t[1])):i))}),h}function U(t,i,s,a,h,e,n){var r=Math.floor((24-i)/2*n),c=24-r;return s-=r/2,[t,i,t+a,i,(h=Math.max(0,t+h+h*n))+e,s,t+a,c,t,c,h,s]}function h(t,a,i,s=4,h=0){Ob(a),t=i.cc;var e=i.bc,n=i.yc,r=i.qc,c=i.Jc,o=i.uc,b=i.sc,l=i.tc,u=i.rc,d=i.dd,y=i.bd,g=i.cd,f=i.zc,w=i.Pc,x=i.Qc,m=2<=s&&s<=6,v=[0,-.5,-1,-.5,0,.5,1,.5][s],p=[.5,.75,1,.75,.5,.25,0,.25][s],M=(s={x:(24-c)*p,y:i.Ic,V:c,W:i.Hc},(i.hc+i.ec)/2),k=(i={x:(1-p+1)/3*(24-M),y:i.fc,V:M,W:i.dc},R(s),R(i),z(i.ya+(24-i.ya)/2)),A=(Math.sin(h)+1)/2;h=U(i.x,i.ya,k,x,f*=v,w,1-A),w=U(i.wb-x,i.ya,k,x,f,w,A),x=[s.Ba-c/4,s.Ca,s.Ba+c/4,s.Ca,i.Ba+M/4,i.Ca-1,i.Ba-M/4,i.Ca-1],o={x:(p=s.x+c*p)+(M=Math.max(1,u/2)),y:(u={x:p-M-o,y:s.y+l,V:o,W:b}).y,V:o,W:b},l={x:b=Math.max(p-d/2,s.x),y:s.y+l+g,V:Math.min(b+d,s.wb)-b,W:y},d=(i,n)=>{Sb(a,t=>{var s=t,a=-.5,h=-.5,e=i,t=n;s.fillStyle=S(t),s.beginPath(),e.forEach((t,i)=>{1!=i%2&&s[0===i?"moveTo":"lineTo"](Math.round(24*a+t),Math.round(24*h+e[i+1]))}),s.closePath(),s.fill()})},y=(i,s)=>{Sb(a,t=>{t.fillStyle=S(s),t.fillRect(Math.round(-12+i.x),Math.round(-12+i.y),Math.round(i.V),Math.round(i.W))})},m?(y(i,t),d(x,t),d(h,t),d(w,t),y(s,n),u.x>=s.x&&y(u,r),o.x<=s.x+c&&y(o,r),y(l,[0,0,0])):(y(s,e),d(x,t),d(h,t),d(w,t),y(i,t))}function S(t){return t?`rgb(${Math.max(0,Math.min(255,t[0]))},${Math.max(0,Math.min(255,t[1]))},`+Math.max(0,Math.min(255,t[2])):"#fff"}function e(i,s,a){const h=E*++T;return Y(i,s,a,h,0),[6,5,4,3,3,2,2,2,1,1,1,1,1].forEach(t=>{Y(W(i,6),W(s,6),W(a,6),h+W(E-t),0+W(E-t),t,t)}),h}function n(t,i,s){const a=e(t,i,s);[14,10,6,3,3,3,2,2].forEach(t=>Y(W(7,9),W(7,9),"a",a+W(E-t),0+W(E-t),t,t))}function r(t){(t=t.createElement("canvas")).width=30*E,t.height=2*E,N=t.getContext("2d"),t.style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)",N.drawImage(kb,1e3,1e3),Y("f",0,0,0,0,12,12),Y("f","f",0,12,12,12,12),e(2,4,3),e(2,4,2),e(3,4,3),e(4,3,3),N.fillStyle="#fff",N.font="20px serif","🔪 🩸 🍖 🌿 💕 ❕ 💢 💀 🍷 🍲 ⛏️ 🪓 🔨 🕯️ 🧱     ".split(" ").forEach(t=>{N.fillText(t,E*++T-1,20)}),n(3,4,3),n(4,3,3),e(3,4,2),e(3,3,3);{const i=E*++T;Y(5,5,6,i,0),[8,8,8,8,8,6,6,6,6,4].forEach(t=>Y(W(8,9),8,"a",i+W(E-t),0+W(E-t/2),t,t/2))}return t.toDataURL()}function i(){(G=I.w=I.m=new Q).Kc(),J=new Xb,F=lc.scale(.5),H=42,Sa=0}function c(){var t=G.N;t!==I.N&&(I.N=t),P[0]&&4&P[0][13]&&(2===L||3===L?I.location.reload():0!==L&&2!==L||(L=1,G.Zc())),t&&(I.vd=g,F=F.ea(t.g,.1),t.B()?L=2:(24<=((t=t.Ab("Meat"))?t.l:0)&&g.O(5),g.count()===g.length&&(L=3))),H=fa(H*(1-Zb/10),3,700),G&&G.update()}function o(){}function b(){}function l(){const t=G.N,s=new w,i=M.width/2,a=M.height/2;var h=M.width/8e3;if(2===L)Tb("YOU DIED",y(i,a-90),90,new w(1,0,0),4),Tb("Press Enter to restart",y(i,a),40,new w(1,.5,.5),4);else if(0===L)Wb(J,"BIT BUTCHER",F.add(y(0,6)),h),Wb(J,"Press Enter to start",F.add(y(0,.4)),h/2);else if(1===L||3===L&&t){var e=t,n=M.width/2,r=e.H[e.P];for(Wb(J,`${r?r.name:"Nothing"} equipped, 1-9: Equip item, E: Action`,qb(y(n,M.height-40)),2/H),r=1;r<=10;r++){const o=y(n-300+60*r,M.height-100);var c=r%10;Rb(o,y(50,70),c===e.P?new w(.9,.9,.9,.3):new w(.1,.1,.1,.3)),(c=e.H[c])&&(Tb(c.J,o.add(y(0,-6)),28),Wb(J,""+c.l,qb(o.add(y(5,14))),2/H))}g.forEach((t,i)=>Tb(`[${t[1]?"X":" "}] `+t[0],y(M.width-300,100+30*i),18,t[1]?new w(.4,1,.4,.5):s,4,new w(0,0,0,t[1]?.5:1),"left")),h=85<t.G?0:1,h=new w(1,h,h,.8),Rb(y(i,40),y(Math.max(0,100-t.G)/100*500,2),h),Tb("Age: "+Math.ceil(t.G),y(i,40),20,h,4),3===L&&(Wb(J,"YOU WIN",F.add(y(0,5)),.2),Tb("Press Enter to play again",y(i,a-80),40,s,4))}}let u;const d=(t,i)=>{if(!fc)throw Error("no Sound");if(!(u=u||{hit:new fc([,,183,.03,.02,.09,,1.49,-1.8,,,,-.01,1.8,-1,.1,,.36,.08,.25]),attack:new fc([,,493,.01,.09,0,4,1.14,,,,,,,,.1,,.1,.01]),craft:new fc([,,7,.03,.28,.44,2,1.44,,-.3,20,.11,.04,,,.1,,.55,.29]),dud:new fc([.8,,112,,.07,.05,1,2.26,-.6,,,,,1.8,,.1,.2,.98,.1,.1]),powerup:new fc([,,1152,,.04,.17,,1.21,,,744,.08,,,,,,.91,.03]),pickup:new fc([1.05,,172,.02,,.17,2,.02,,,-409,.06,,,,.1,,.55,,.19]),walk:new fc([.5,.1,70,,,.01,4,,,,-9,.1,,,,,,.5]),consume:new fc([1.2,,16,.07,.18,.34,1,.38,-.1,-5.6,49,.15,.02,-.1,36,.1,,.39,.14])}))throw Error("no sounds");u[t]?u[t].play(i):console.warn("No sound",t,"in",u)};let g=[["Move (W,A,S,D or Arrows)"],["Pick up and equip knife (#)"],["Stab an animal"],["Breed animals (herbs)"],["Make forbidden wine (10 blood)"],["Collect 24 meat"],["Eat a meaty, home-cooked meal"]],f=g;f.O=t=>{f[t][1]||d("powerup"),f[t][1]=(f[t][1]||0)+1},f.count=()=>f.reduce((t,i)=>t+(i[1]?1:0),0);const v=ma;class x extends Lb{constructor(t={}){var{g:t=y(),size:i=y(1),j:s=1,v:a,angle:h,m:e,ha:n=0,name:r=ma(999),s:c=0}=t;super(t,i,s,a,h),this.name=r,this.m=e,this.facing=k,this.direction=4,this.$=new B,this.s=c,this.ha=n,this.ba=y(1)}setDirection(){this.direction=Math.round(this.facing<0?4+4*(k+this.facing)/k:4*this.facing/k)%8}wa(t){if(this.B()||this.$.active())return 0;this.$.set(1);for(var i of this.children)i.$&&i.$.set(1);return t=ea(this.s-t,0),i=this.s-t,(this.s=t)||this.la(),i}B(){return!this.s}la(){Db(this)}update(){var t;super.update(),this.setDirection(),this.B()||null==this.$.time?this.Ga=new w(0,0,0,0):(t=.5*ia(this.$.get(),.15,0),this.Ga=new w(t,.1,.1,.5))}Sa(){return this.m.Y.find(t=>t.Nc&&!t.B())}}class m extends x{constructor(i){super(i),this.qa=new B,this.na=new B,this.$a=new B(t(10)),this.jb=new B,this.Ja=new B,this.Zb=new B,this.Lb=new B,this.Qa=null,this.R=new B,this.zb=new B,this.color=za(t()),this.Ia=i.Ia||null,this.species=i.species||a(this.Ia)||s(this.color),this.U=10,this.s=2,this.Nb=.14,this.Kb=7,this.Ob=1/0,this.Bb=this.Yb=!1,Hb(this,1),this.oa=this.pa=this.G=0,this.Fa=1,this.C=y(),this.T=y(),this.max=y(window.ib),this.H=[,,,,,,,,,,],this.P=-1,this.X=this.A=null,Gb(this,this.Pa=new x({j:9})),this.Pa.ma=y(0,1.2),this.cb(),Gb(this,this.Ka=new vc(y(),0,0,0,0,k,void 0,void 0,new w(1,.2,.2),new w(.5,.1,.1),new w(.4,.1,.1),new w(.4,.2,.2,.3),5,.2,.1,.07,.1,.95,.95,1,k,.01,.2,1),y(),0),this.Ka.F=.5}cb(t){this.Pa.ba=y(t?1:0),t&&(this.Pa.j={estrous:9,fear:10,anger:11,dead:12}[t])}td(){var t,i;this.B()?this.Qa="dead":(t=-1*this.R.get(),i=-1*this.zb.get(),this.Qa=0<t&&i<t?"estrous":0<i?"fear":null),this.cb(this.Qa)}wa(i,s){return(i=super.wa(i,s))<=0?0:(d("hit",this.g),s&&s.g&&(this.h=this.h.add(this.g.u(s.g).scale(t(.4,.8)))),this.lb(),this.na.time=void 0,i)}lb(){this.Ja.active()||(this.Ja.set(this.B()?.5:.2),this.Ka.xa=100)}jc(){this.Ja.active()||(this.Ka.xa=0)}xc(s){var t=this.H.findIndex((t,i)=>t&&t.name===s&&(t.l||0)<(t.stack||0)&&0<i);return-1!==t?t:this.H.findIndex((t,i)=>!t&&0<i)}Ab(i){var t=this.H.findIndex(t=>t&&t.name===i);return t<0?null:this.H[t]}S(){return this.H[this.P]}Qb(t){var i,s;"number"!=typeof i&&(i=this.xc(t.name)),!t||i<1||9<i||((s=this.H[i])&&s.name===t.name&&(s.l||0)<(s.stack||0)?s.l=(s.l||0)+1:this.H[i]=t,d("pickup",this.g))}throw(){}sd(t){this.xb(this.P===t?-1:t)}kd(){this.xb(this.P)}xb(t){t<-1||9<t||(this.P=t,t=this.H[this.P],this.A&&this.A.la(),t&&("Butcher knife"===t.name&&g.O(1),Gb(this,this.A=new A({L:{...t},m:this.m},y(-.2,.2))),t.l||(this.A.ba=y())))}Ec(){var t=this.S();return t&&t.weight||0}Hb(){var t=this.S();if(t)return t.kb||0}attack(){d("attack",this.g)}Fb(t=[],a){let h;return t.reduce((t,i)=>{var s=wa(i.g,a)**.5;return s<t?(h=i,s):t},1/0),h}wc(t=this.g){var i=this.m.Y.filter(t=>!t.B()&&t!==this);const s=this.A;return i=i.filter(t=>la(t.g,t.size,s.g,s.size)),this.Fb(i,t)}vc(t=this.g){var i=this.S();(t=this.wc(t))&&i.l?(this.Ma(i,!0),t.s+=1,t.R.set(10),d("craft",this.g)):d("dud",this.g)}qb(t){const i=this.S();"wine"===t?"Blood"!==i.name||i.l<10?d("dud",this.g):(i.l-=10,g.O(4),this.m.I("Blood wine",this.g,2),d("craft")):"meal"===t&&("Meat"!==i.name||i.l<24?d("dud",this.g):(i.l-=24,this.m.I("Meal",this.g,2),d("craft",this.g)))}La(){const t=this.m,i=this.Ua(),s=29!==t.Db(i).j;if(s){var a=this.Ab("Stone");if(!this.Ma(a,!0))return void d("dud")}d("attack"),s||t.I("Stone",i,1),t.Ub(i,s?{j:29,ta:!0}:{j:4,ta:!1})}Na(){const t=this.m,i=this.Ua();console.log(i);var s=25===(s=t.Db(i)).j||26===s.j;d("attack"),s&&t.I("Stone",i,2,ma(1,3)),t.Ub(i,{j:4,ta:!1})}Ma(t,i){return!t||t.l<=0?0:(--t.l,t.hb&&(this.s+=1,this.G=Math.round(Math.max(1,this.G-(t.hb||0)-this.G/10))),this.kd(),"Meal"===t.name&&g.O(6),i||d("consume",this.g),1)}Aa(){this.Lb.active()||(this.Lb.set(1),this.h=this.h.add(ra(y(),this.facing,.5)))}Ua(){return this.A?this.m.gb(this.A.g.add(ra(y(),this.facing,.7))).add(y(.5,.5)):null}action(t){if(!this.qa.active()){var i=this.S();if(this.qa.set(.25),i)return i.Aa&&this.Aa(i.Aa),i.ha?this.attack():i.kb?this.vc(t):("Blood"===i.name&&this.qb("wine"),"Meat"===i.name&&this.qb("meal"),void(i.La?this.La():i.Na?this.Na():i.pb&&this.Ma(i)))}}hd(){this.$a.active()||(this.$a.set(t(2,20)),this.X=(wa(this.g,this.m.Z)**.5>this.m.size.x/3?this.m.Z:this.g).add(y(t(-10,10),t(-10,10))),this.Fa=t(1))}Tc(){var t;this.na.active()||(t=this.Wc(),this.R.active()?this.Vc():t||this.Uc())}Wc(){var i,s;return!this.Yb||!(i=this.m.Y.find(t=>t.ld&&!t.B()&&!t.Hb()&&t!==this))||(s=wa(i.g,this.g)**.5)>this.Kb?0:(this.na.set((s=s<6)?.5:t(.5,2)),this.zb.set(1),s&&(i=this.g.u(i.g).normalize(7),this.Wa(this.g.add(i))),s)}Wa(t=null,i){i&&this.$a.set(60),this.X=t,this.Fa=1}Uc(){var i,s;this.Bb&&(i=this.Sa())&&!((s=wa(i.g,this.g)**.5)>this.Kb||4<s)&&i.S()&&i.Hb()&&i.A&&(this.X=i.A.g.add(ra(y(),t(2*k),t(1,2))))}Vc(){var t;this.R.active()&&(this.na.set(1),(t=this.m.Y.filter(t=>!t.B()&&t.R.active()&&t!==this)).length&&(t=this.Fb(t,this.g))&&(la(t.g,t.size,this.g,this.size)?this.ad(t):this.X=t.g))}ad(t){this.na.set(5),t.R.time=void 0,this.R.time=void 0,g.O(3),this.m.Mb(this.g,[this.species,t.species])}Gc(){this.jb.active()||(this.jb.set(5),this.G+=1,this.Lc()&&this.wa(1,this))}Lc(){return this.G>this.Ob}Sc(){var t,i;this.B()||((i=(t=this.T.D()).x||t.y)&&this.Wa(null,!0),this.Tc(),this.hd(),this.C=this.h.D(),i?(t=t.scale(.04*this.Fa),this.C=this.C.add(t),this.Zb.active()||(d("walk",this.g),this.Zb.set(.21))):this.X&&.75<wa(this.g,this.X)**.5&&(this.C=this.C.ea(this.X.u(this.g),.5)),t=this.Nb*this.Fa*(1-this.Ec()),this.C.x=fa(this.C.x,-t,t),this.C.y=fa(this.C.y,-t,t),this.h=y((this.h.x>t||this.h.x<-t?this.h:this.C).x,(this.h.y>t||this.h.y<-t?this.h:this.C).y),t=this.h.length(),this.pa+=3.5*this.C.length(),this.pa%=1e4,this.oa+=.5*t,this.oa=.01<t?(this.oa%1+1)%1:0,this.facing=this.h.angle(),this.Gc())}update(){this.td(),this.Sc(),this.jc();const t=y(.9999);0===this.T.x&&(t.x=.9),0===this.T.y&&(t.y=.9),this.h=this.h.multiply(t),super.update()}fa(){var t=this.A;t&&t.Da&&Qb(this.Ua(),t.size,new w(.5,1,1,.2));const i=this.g.add(y(0,.05*Math.sin(this.oa*k)));[[1,.2],[.9,.1]].forEach(t=>Qb(i.add(y(0,.75*-this.size.y)),y(this.size.x*t[0],t[1]),new w(0,0,0,.1),this.angle)),h(lb,i,this.species,this.direction,this.pa)}}class p extends m{constructor(t){super(t),this.Nc=!0,this.s=5,this.Nb=.2,this.U=10,this.G=18,this.Ob=100}update(){Yb(2)&&this.Wa(pb,!0),[48,49,50,51,52,53,54,55,56,57].forEach(t=>{P[0]&&2&P[0][t]&&this.sd(t-48)}),(Yb(81)||ac(1))&&this.throw(),(Yb(69)||Yb(0)||ac(0))&&this.action(pb),((this.T=$b?cc[0]&&cc[0][0]||y():y(Yb(39)-Yb(37),Yb(38)-Yb(40)))&&this.T.x||this.T.y)&&g.O(0),this.ld=!0,super.update(),this.ud()}ud(){const t=this.A;var i,s;t&&(i=this.S())&&(s=this.qa.active()?1.1:.8,t.ba=y(i.l?this.qa.active()?1.2:1:0),t.ma=ra(y(),this.facing,s),s=y(),0===this.direction?s=y(.35,-.1):1===this.direction?s=y(.2,-.2):7===this.direction&&(s=y(-.2,-.1)),t.ma=t.ma.add(s),t.Jb=this.facing+1.2*k+(i.Xa||0),t.U=t.g.y<this.g.y?11:9)}}class O extends m{constructor(t){super(t),this.Bb=this.Yb=!0}la(){d("hit",this.g),this.s=0,this.lb(),this.cb("dead"),setTimeout(()=>this.m.I("Meat",this.g,1),500),setTimeout(()=>super.la(),4e3)}update(){super.update();const t=this.Sa();var i=t?t.A:null;!this.B()&&i&&i.L.ha&&la(this.g,this.size,i.g,i.size)&&(g.O(2),this.wa(i.L.ha,i)&&((i={...this.m.Eb("Blood")}).l=ma(1,3),t.Qb(i)))}}class A extends x{constructor(t){super(t),this.L=t.L,this.Da=t.L.Da,this.j=this.L.j,this.yb=new B}update(){super.update();const t=this.Sa();this.B()?(this.ba=y(1-Ea(this.yb)),t&&(this.g=this.g.ea(t.g,.1))):t&&la(this.g,this.size,t.g,t.size)&&(t.Qb(this.L),this.s=0,this.yb.set(.4),setTimeout(()=>this.la(),400))}}class X extends x{constructor(t){super(t),this.bb=new B,this.Za=new B,Hb(this,0),this.j=1,this.Ya=this.g.D()}update(){var i;super.update(),this.bb.active()||(i=wa(this.g,this.Ya)**.5,this.Za.active()?1<i?(this.h=this.h.ea(this.Ya.u(this.g),.9),this.h=xa(this.h,4)):(this.h=this.h.scale(.1),this.bb.set(10),this.Za.time=void 0):.2<t()?(this.m.N&&this.m.I("Herb",this.g,1),this.bb.set(10)):(this.Ya=this.m.Gb(),this.Za.set(5)))}}const C=[1,2,27,3,28,4],j=t=>(t=1e4*Math.sin(t))-Math.floor(t);class D{constructor(t){this.size=y(200,200),this.Z=this.size.scale(.5),this.key=D.getKey(t),this.g=t,this.seed=Math.round(1e5*j(1e4*t.y+t.x+1235)),this.pc=this.Ac(),this.rd=this.Bc(),this.rb={},console.log(this)}static getKey(t){return t.x+","+t.y}Ac(){var i=[];ta=this.seed;for(let t=999;t--;){var s=i,a=s.push;ta=(ta=(ta^=ta<<13)^ta>>>17)^ta<<5,a.call(s,1+-1*ca(ta%1e9)/1e9)}return i}ja(t){return this.pc[t%999]}Cc(t){return y(200*this.ja(t),200*this.ja(t+1))}Dc(t,i=1,s=0){return s+(i-s)*this.ja(t)}za(t,i=1,s=0){return 0|this.Dc(t,i,s)}Bc(){const i=[{g:y(100,100),Wb:0,weight:1}];for(let t=200;t--;){var s=4*t;i.push({g:this.Cc(s),Wb:this.za(3+s,C.length),weight:.2+.8*this.ja(4+s)})}return i}Xc(t){const i=this.size.x,s=this.size.y,a=y();for(a.x=i;a.x--;)for(a.y=s;a.y--;)t(a,a.x+a.y*i)}Fc(a){let h;return this.rd.reduce((t,i)=>{var s=wa(i.g,a)**.5*i.weight;return s<t?(h=i.Wb,s):t},1/0),h}Cb(t){var i,s,a,h,e;return(i=this.rb[D.getKey(t)])?{...i}:(i=Math.round(999*j(t.x+200*t.y)),s=this.ja(i),a=this.Fc(t),t=(e=((h=28===(a=C[a]))?.975:.991)<s)&&(h||wa(t,this.Z)**.5>200/3.5),s<.1?a=1:s<.2?a+=this.za(++i,-1,1):s<.4&&(a=this.za(++i,1,5)),{j:a=t?25+this.za(++i,2):a,color:t=e&&!t?sa():void 0,ta:e})}oc(t,i={}){this.rb[D.getKey(t)]=i}}class Q{constructor(){this.size=y(200,200),this.Z=this.size.scale(.5),this.items=[],this.Y=[],this.od=[],this.Oc=[{name:"Meat",j:7,l:1,stack:64,J:"🍖"},{name:"Blood",j:6,l:1,stack:64,J:"🩸"},{name:"Butcher knife",type:"w",j:5,l:1,stack:8,ha:1,Aa:1,J:"🔪"},{name:"Herb",j:8,l:1,stack:64,kb:1,J:"🌿",$b:-.6,Xa:k/2},{name:"Blood wine",j:13,l:1,stack:64,hb:10,pb:1,J:"🍷"},{name:"Meal",j:14,l:1,stack:8,hb:1,pb:1,J:"🍲"},{name:"Hammer",j:17,l:1,stack:8,La:1,weight:.5,Da:1,J:"🔨",Xa:k},{name:"Pickaxe",j:15,l:1,stack:8,Na:1,weight:.5,Da:1,J:"⛏️",Xa:k},{name:"Stone",j:19,l:1,stack:64,J:"🧱"}],this.Xb=[],this.mb=y(),this.nb={},this.N=0,this.ka}Zc(){this.N=new p({g:this.Z.D(),m:this}),this.Y.push(this.N)}Eb(i){return this.Oc.find(t=>t.name===i)}Gb(){return y(t(this.size.x),t(this.size.y))}I(i,s,a=0,h=1){var e="string"==typeof i?this.Eb(i):i;for(e||console.error("Cannot make item",i),i=h;i--;)h=a?s.add(y(t(-a,a),t(-a,a))):s.D(),this.items.push(new A({L:e,g:h,s:1,m:this,angle:(e.$b||0)+t(-.2,.2)}))}Mb(t,i){this.Y.push(new O({j:0,g:t,m:this,Ia:i}))}$c(){this.od.push(new X({g:this.Gb(),m:this}))}Yc(){var t=new D(this.mb);return this.nb[t.key]=t}Va(){var t=D.getKey(this.mb);return this.nb[t]||this.Yc()}gb(t){return y(Math.floor(t.x),Math.floor(t.y))}Db(t){return this.Va().Cb(this.gb(t))}Ub(t,i){t=this.gb(t),rc(this.ka),this.Tb(t,i,!0),i=this.ka,zb(1),[K,lb,F,H]=i.Sb}Tb(t,i={},s){var a=i.j,h=i.color,e=i.ta;this.Va().oc(t,i),e?nc(t,1):s&&nc(t,0),this.ka.setData(t,new oc(a,ma(4),ma(2),h),s)}Kc(){var i=this.size;const s=this.Va();let a;for(a=20;a--;)for(let i=2;i--;)this.Mb(y(t(200),t(200)));const h=i=>this.Z.add(ra(y(),t(2*k),i));this.I("Butcher knife",h(9)),this.I("Pickaxe",h(34)),this.I("Hammer",h(35)),[20,21,100,t(20,100)].forEach(t=>this.I("Herb",h(t))),this.$c(),mc(i.D()),this.ka=new sc(i),i=new sc(i),s.Xc(t=>{this.Tb(t,s.Cb(t))}),this.Xb=[this.ka,i],this.Xb.forEach(s=>{rc(s,1);for(let i=s.size.x;i--;)for(let t=s.size.y;t--;)pc(s,y(i,t));zb(1),[K,lb,F,H]=s.Sb})}update(){const s=this.N;if(s){let t,i;s.g.x>this.size.x?t=0:s.g.x<0&&(t=this.size.x),s.g.y>this.size.y?i=0:s.g.y<0&&(i=this.size.y),void 0!==t&&(s.g.x=t,F=s.g),void 0!==i&&(s.g.y=i,F=s.g)}}}const E=window.ib||24;let N,T=0,W=ma;const Y=(t,i,s,a,h,e=E,n=E)=>{N.fillStyle="#"+t+i+s,N.fillRect(a,h,e,n)},I=window;let L=0;I.ib=24;let G,J;(async()=>{var s;Qa=y(24),jb(i,c,o,b,l,await new Promise(t=>{const i=new Image;i.onload=()=>t(r(document)),s?i.src=s:i.onload()}))})()}();